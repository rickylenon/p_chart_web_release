"use strict";(()=>{var e={};e.id=1574,e.ids=[1574],e.modules={53524:e=>{e.exports=require("@prisma/client")},98432:e=>{e.exports=require("bcryptjs")},60614:e=>{e.exports=require("next-auth/jwt")},62113:e=>{e.exports=require("next-auth/next")},47449:e=>{e.exports=require("next-auth/providers/credentials")},41649:e=>{e.exports=require("next-auth/react")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},88960:(e,t,r)=>{r.r(t),r.d(t,{config:()=>c,default:()=>l,routeModule:()=>p});var o={};r.r(o),r.d(o,{default:()=>u});var i=r(71802),n=r(47153),s=r(56249),a=r(44507);async function d(e,t,r){if("GET"===e.method)try{let r=parseInt(e.query.page)||1,o=parseInt(e.query.limit)||10,i=e.query.search||"",n=e.query.sortField||"createdAt",s=e.query.sortDirection||"desc",d=(r-1)*o;console.log("API Request Parameters:",{page:r,limit:o,search:i,sortField:n,sortDirection:s,skip:d});let u={quantity:"poQuantity",itemName:"itemName",status:"status",poNumber:"poNumber",lotNumber:"lotNumber",createdDate:"createdAt",modifiedDate:"updatedAt",currentOperation:"currentOperation",lockStatus:"editingUserId",actions:"editingUserId"}[n]||n;console.log(`Mapped ${n} to database field ${u}`),("actions"===n||"lockStatus"===n)&&console.log(`Sorting by lock status: ${n} -> ${u} (${s})`);let l=i?{OR:[{poNumber:{contains:i}},{lotNumber:{contains:i}},{itemName:{contains:i}}]}:{},c=await a.Z.productionOrder.count({where:l}),p=await a.Z.productionOrder.findMany({where:l,skip:d,take:o,orderBy:{[u]:"asc"===s?"asc":"desc"},include:{operations:{select:{operation:!0,startTime:!0,endTime:!0}}}});console.log("API Response:",{totalOrders:p.length,page:r,sortField:u,sortDirection:s,firstOrder:p[0]?.poNumber,lastOrder:p[p.length-1]?.poNumber});let m=[...new Set(p.filter(e=>null!==e.editingUserId).map(e=>e.editingUserId))].filter(e=>null!==e);console.log(`Found ${m.length} unique editing user IDs to check:`,m);let g=[];if(m.length>0)try{let e=m.map(e=>"string"==typeof e?parseInt(e):e).filter(e=>!isNaN(e));console.log("Numeric user IDs to check:",e),g=(await a.Z.user.findMany({where:{id:{in:e}},select:{id:!0}})).map(e=>e.id),console.log(`Found ${g.length} existing users out of ${m.length} editing users:`,g)}catch(e){console.error("Error checking editing user existence:",e)}let h=p.map(e=>{let t=!!e.editingUserId&&!g.includes("string"==typeof e.editingUserId?parseInt(e.editingUserId):e.editingUserId);return console.log(`Order ${e.poNumber} - editingUserId: ${e.editingUserId}, isUserDeleted: ${t}`),{poNumber:e.poNumber,lotNumber:e.lotNumber||"",quantity:e.poQuantity,itemName:e.itemName||"",status:e.status.toLowerCase(),currentOperation:e.currentOperation,currentOperationStartTime:e.currentOperationStartTime,currentOperationEndTime:e.currentOperationEndTime,operations:e.operations.map(e=>({operation:e.operation,startTime:e.startTime,endTime:e.endTime})),createdDate:e.createdAt,modifiedDate:e.updatedAt,isLocked:!!(e.editingUserId&&e.lockedAt),editingUserId:e.editingUserId||null,editingUserName:e.editingUserName||null,lockedAt:e.lockedAt||null,isUserDeleted:t}});return t.status(200).json({orders:h,pagination:{total:c,page:r,limit:o,totalPages:Math.ceil(c/o)}})}catch(e){return console.error("Error fetching production orders:",e),t.status(500).json({error:"Failed to fetch production orders"})}else if("POST"===e.method)try{let{poNumber:r,lotNumber:o,quantity:i,itemName:n}=e.body;if(!r)return t.status(400).json({error:"PO Number is required"});let s=await a.Z.productionOrder.create({data:{poNumber:r,lotNumber:o||"",poQuantity:parseInt(i)||0,itemName:n||"",status:"CREATED"}});return console.log(`Created new production order: ${r}`),t.status(201).json(s)}catch(e){return console.error("Error creating production order:",e),t.status(500).json({error:"Failed to create production order"})}return t.setHeader("Allow",["GET","POST"]),t.status(405).json({error:`Method ${e.method} not allowed`})}let u=(0,r(66826).QO)(d),l=(0,s.l)(o,"default"),c=(0,s.l)(o,"config"),p=new i.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/production-orders",pathname:"/api/production-orders",bundlePath:"",filename:""},userland:o})}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[549],()=>r(88960));module.exports=o})();