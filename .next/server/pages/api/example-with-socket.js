"use strict";(()=>{var e={};e.id=7510,e.ids=[7510],e.modules={53524:e=>{e.exports=require("@prisma/client")},98432:e=>{e.exports=require("bcryptjs")},60614:e=>{e.exports=require("next-auth/jwt")},62113:e=>{e.exports=require("next-auth/next")},47449:e=>{e.exports=require("next-auth/providers/credentials")},41649:e=>{e.exports=require("next-auth/react")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},29505:e=>{e.exports=import("socket.io")},30379:(e,t,o)=>{o.a(e,async(e,r)=>{try{o.r(t),o.d(t,{config:()=>l,default:()=>c,routeModule:()=>u});var i=o(71802),s=o(47153),n=o(56249),d=o(45649),a=e([d]);d=(a.then?(await a)():a)[0];let c=(0,n.l)(d,"default"),l=(0,n.l)(d,"config"),u=new i.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/example-with-socket",pathname:"/api/example-with-socket",bundlePath:"",filename:""},userland:d});r()}catch(e){r(e)}})},88768:(e,t,o)=>{o.a(e,async(e,r)=>{try{o.d(t,{vW:()=>n});var i=o(44423),s=e([i]);i=(s.then?(await s)():s)[0];let n=(e,t)=>{try{let o=(0,i.getIO)();console.log(`Emitting ${e} to all clients:`,t),o.emit(e,t)}catch(e){console.error("Failed to emit socket event:",e)}};r()}catch(e){r(e)}})},48352:(e,t,o)=>{o.r(t),o.d(t,{default:()=>n});let r=require("next-auth");var i=o.n(r),s=o(66826);let n=i()(s.Lz)},45649:(e,t,o)=>{o.a(e,async(e,r)=>{try{o.r(t),o.d(t,{default:()=>a});var i=o(62113),s=o(48352),n=o(88768),d=e([n]);async function a(e,t){let o=await (0,i.getServerSession)(e,t,s.authOptions);if(!o)return t.status(401).json({error:"Unauthorized"});if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let{action:r,data:i}=e.body;if(!r||!i)return t.status(400).json({error:"Missing required fields"});console.log(`Processing ${r} with data:`,i);let s={id:Math.floor(1e3*Math.random()),action:r,data:i,processedAt:new Date().toISOString(),processedBy:o.user.email};return(0,n.vW)("data-updated",{type:r,item:s,user:o.user.email}),console.log("Emitted data-updated event to all clients"),t.status(200).json({success:!0,message:"Action processed successfully",result:s})}catch(e){return console.error("Error processing action:",e),t.status(500).json({error:"Internal server error"})}}n=(d.then?(await d)():d)[0],r()}catch(e){r(e)}})},44423:(e,t,o)=>{o.a(e,async(e,r)=>{try{let d;o.r(t),o.d(t,{default:()=>n,getIO:()=>a,getSafeIO:()=>c});var i=o(29505),s=e([i]);function n(e,t){if(t.socket.server.io){console.log("Socket server already running"),t.end();return}console.log("Setting up Socket.IO server...");let o=new i.Server(t.socket.server,{path:"/api/socketio",addTrailingSlash:!1,cors:{origin:"*",methods:["GET","POST"],credentials:!0}});t.socket.server.io=o,d=o,o.on("connection",e=>{console.log("Client connected:",e.id),e.on("join-user-room",t=>{t&&(console.log(`User ${t} joined their personal room`),e.join(`user-${t}`))}),e.on("join-role-room",t=>{if(t){let o=t.toLowerCase();console.log(`User joined ${o} room`),e.join(`role-${o}`)}}),e.on("defect-edit-requested",e=>{console.log("Defect edit requested:",e);let t={id:e.requestId||Date.now().toString(),type:"defect-edit",title:"New Defect Edit Request",message:`A defect edit has been requested for ${e.defectCode||"a defect"}`,isRead:!1,createdAt:new Date().toISOString(),linkUrl:"/notifications",sourceId:e.defectId,sourceType:"defect"};o.to("role-admin").emit("notification-defect-edit",t),o.to("role-admin").emit("notification-count-update",{type:"defect-edit"}),console.log("Emitted defect-edit notification to all admins")}),e.on("defect-edit-resolved",e=>{console.log("Defect edit resolved:",e);let t={id:e.responseId||Date.now().toString(),type:"defect-edit",title:"Defect Edit Request Resolved",message:e.approved?"Your defect edit request was approved":"Your defect edit request was rejected",isRead:!1,createdAt:new Date().toISOString(),linkUrl:"/notifications",sourceId:e.defectId,sourceType:"defect"};e.requestedById&&(o.to(`user-${e.requestedById}`).emit("notification-defect-edit",t),o.to(`user-${e.requestedById}`).emit("notification-count-update",{type:"defect-edit"}),console.log(`Emitted defect-edit resolution notification to user ${e.requestedById}`))}),e.on("disconnect",()=>{console.log("Client disconnected:",e.id)})}),console.log("Socket server initialized successfully"),t.end()}i=(s.then?(await s)():s)[0];let a=()=>{if(!d)throw Error("Socket.IO has not been initialized. Call the socket API route first.");return d},c=()=>d||null;r()}catch(e){r(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[549],()=>o(30379));module.exports=r})();