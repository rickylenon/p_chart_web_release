"use strict";(()=>{var e={};e.id=477,e.ids=[477],e.modules={53524:e=>{e.exports=require("@prisma/client")},98432:e=>{e.exports=require("bcryptjs")},60614:e=>{e.exports=require("next-auth/jwt")},62113:e=>{e.exports=require("next-auth/next")},47449:e=>{e.exports=require("next-auth/providers/credentials")},41649:e=>{e.exports=require("next-auth/react")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},49624:(e,t,r)=>{r.r(t),r.d(t,{config:()=>c,default:()=>p,routeModule:()=>g});var a={};r.r(a),r.d(a,{default:()=>d});var s=r(71802),o=r(47153),n=r(56249),i=r(66826),u=r(44507);async function l(e,t,r){if(console.log("Audit Logs API called"),"GET"!==e.method)return t.setHeader("Allow",["GET"]),t.status(405).json({error:`Method ${e.method} Not Allowed`});try{let a=r?.user?.role||"",s="string"==typeof a&&"admin"===a.toLowerCase();if(console.log("Audit Logs API - User role:",a,"Is admin?",s),!s)return t.status(403).json({error:"Forbidden - Only admin users can access audit logs"});let{tableName:o,recordId:n,limit:i="50",page:l="1"}=e.query;console.log("Audit Logs API query params:",{tableName:o,recordId:n,limit:i,page:l});let d={};o&&"string"==typeof o&&(d.tableName=o),n&&"string"==typeof n&&(d.recordId=n);let p=Math.min(parseInt(i,10)||50,100),c=parseInt(l,10)||1,g=(c-1)*p,m=await u.Z.auditLog.count({where:d}),f=(await u.Z.auditLog.findMany({where:d,orderBy:{timestamp:"desc"},include:{user:{select:{name:!0,username:!0}}},skip:g,take:p})).map(e=>({id:e.id,tableName:e.tableName,recordId:e.recordId,action:e.action,oldValues:e.oldValues?JSON.parse(e.oldValues):null,newValues:e.newValues?JSON.parse(e.newValues):null,user:e.user.name||e.user.username,timestamp:e.timestamp,ipAddress:e.ipAddress,userAgent:e.userAgent}));return console.log(`Returning ${f.length} audit logs out of ${m} total`),t.status(200).json({data:f,pagination:{total:m,page:c,limit:p,pages:Math.ceil(m/p)}})}catch(e){return console.error("Error fetching audit logs:",e),t.status(500).json({error:"Failed to fetch audit logs",details:e instanceof Error?e.message:"Unknown error"})}}let d=(0,i.QO)(l),p=(0,n.l)(a,"default"),c=(0,n.l)(a,"config"),g=new s.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/audit-logs",pathname:"/api/audit-logs",bundlePath:"",filename:""},userland:a})}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[549],()=>r(49624));module.exports=a})();