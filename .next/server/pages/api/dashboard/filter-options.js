"use strict";(()=>{var e={};e.id=558,e.ids=[558],e.modules={53524:e=>{e.exports=require("@prisma/client")},98432:e=>{e.exports=require("bcryptjs")},60614:e=>{e.exports=require("next-auth/jwt")},62113:e=>{e.exports=require("next-auth/next")},47449:e=>{e.exports=require("next-auth/providers/credentials")},41649:e=>{e.exports=require("next-auth/react")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},70729:(e,t,r)=>{r.r(t),r.d(t,{config:()=>p,default:()=>d,routeModule:()=>c});var n={};r.r(n),r.d(n,{default:()=>u});var o=r(71802),i=r(47153),s=r(56249),a=r(44507);async function l(e,t="Operation",r,n,o,i){console.log(`Fetching unique ${e} values from ${t}`,{parentField:r,dateField:n,startDate:o,endDate:i}),console.time(`unique-${e}-query`);try{if("Operation"===t){let t=n&&o&&i?{[n]:{gte:o,lte:i}}:{};if(!r){if("lineNo"===e){let r=await a._.operation.groupBy({by:["lineNo"],where:t,orderBy:{lineNo:"asc"}});return console.timeEnd(`unique-${e}-query`),console.log(`Found ${r.length} unique lines`),r.filter(e=>null!==e.lineNo).map(e=>e.lineNo)}let r=await a._.operation.findMany({where:t,select:{[e]:!0},distinct:[e]});console.timeEnd(`unique-${e}-query`);let n=r.map(t=>t[e]);if("startTime"===e||"endTime"===e)return[...new Set(n.map(e=>e instanceof Date?e.getFullYear():null))].filter(Boolean).sort((e,t)=>Number(t)-Number(e));return[...new Set(n)].filter(Boolean).sort()}if("productionOrder"===r){let r=(await a._.operation.groupBy({by:["productionOrderId"],where:t})).filter(e=>null!==e.productionOrderId).map(e=>e.productionOrderId);if("status"===e){let t=await a._.productionOrder.groupBy({by:["status"],where:{id:{in:r}}});return console.timeEnd(`unique-${e}-query`),console.log(`Found ${t.length} unique statuses`),t.filter(e=>null!==e.status).map(e=>e.status)}if("series"===e){let t=await a._.productionOrder.groupBy({by:["itemName"],where:{id:{in:r}}});console.timeEnd(`unique-${e}-query`),console.log(`Found ${t.length} unique items/series`);let n=t.filter(e=>null!==e.itemName).map(e=>{let t=e.itemName||"",r=t.substring(0,5);return console.log(`Extracted series code '${r}' from item '${t}'`),r}).filter(e=>5===e.length);return[...new Set(n)].sort()}}}return console.timeEnd(`unique-${e}-query`),[]}catch(t){return console.error(`Error fetching unique ${e} values:`,t),console.timeEnd(`unique-${e}-query`),[]}}let u=(0,r(66826).QO)(async function(e,t,r){try{let n,o;console.log("API: Dashboard filter options auth session validated, user:",r?.user?.name),console.log("Fetching dashboard filter options");let{year:i,month:s}=e.query;if(i){let e=Array.isArray(i)?i[0]:i,t=parseInt(e);if(n=new Date(Date.UTC(t,0,1)),o=new Date(Date.UTC(t,11,31,23,59,59,999)),s&&"All"!==s){let e=Array.isArray(s)?s[0]:s,r=parseInt(e)-1;n=new Date(Date.UTC(t,r,1)),o=new Date(Date.UTC(t,r+1,0,23,59,59,999))}}console.log("Date range for filter options:",{startDate:n,endDate:o});let[a,u,d,p]=await Promise.all([l("startTime"),l("lineNo"),l("series","Operation","productionOrder","startTime",n,o),l("status","Operation","productionOrder","startTime",n,o)]);return console.log("Filter options counts:",{years:a.length,lines:u.length,series:d.length,statuses:p.length}),t.status(200).json({years:a,lines:u,series:d,statuses:p})}catch(e){return console.error("Error in filter options API:",e),t.status(500).json({error:"Failed to fetch filter options"})}}),d=(0,s.l)(n,"default"),p=(0,s.l)(n,"config"),c=new o.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/dashboard/filter-options",pathname:"/api/dashboard/filter-options",bundlePath:"",filename:""},userland:n})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[549],()=>r(70729));module.exports=n})();