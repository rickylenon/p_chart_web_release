"use strict";(()=>{var t={};t.id=5664,t.ids=[5664],t.modules={53524:t=>{t.exports=require("@prisma/client")},98432:t=>{t.exports=require("bcryptjs")},60614:t=>{t.exports=require("next-auth/jwt")},62113:t=>{t.exports=require("next-auth/next")},47449:t=>{t.exports=require("next-auth/providers/credentials")},41649:t=>{t.exports=require("next-auth/react")},20145:t=>{t.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},574:(t,e,r)=>{r.r(e),r.d(e,{config:()=>p,default:()=>l,routeModule:()=>f});var s={};r.r(s),r.d(s,{default:()=>c});var a=r(71802),o=r(47153),d=r(56249),n=r(44507);async function i(t,e,r){try{console.log("API: StandardCosts [id] auth session validated, user:",r?.user?.name);let{id:s}=t.query,a=parseInt(s,10);if(isNaN(a))return e.status(400).json({error:"Invalid standard cost ID"});let o=r?.user?.role||"",d="admin"===o.toLowerCase();if("GET"!==t.method&&!d)return e.status(403).json({error:"Admin access required"});if("GET"===t.method){console.log(`Fetching standard cost with ID: ${a}`);let t=await n.Z.standardCost.findUnique({where:{id:a}});if(!t)return e.status(404).json({error:"Standard cost not found"});let r={...t,costPerUnit:Number(t.costPerUnit)};return e.status(200).json(r)}if("PUT"===t.method)try{let s="string"==typeof t.body?JSON.parse(t.body):t.body;console.log(`Updating standard cost ${a} with data:`,s);let{itemName:o,description:d,costPerUnit:i,currency:c}=s;if(!o||!i)return e.status(400).json({error:"Item name and cost per unit are required"});let l=parseFloat(i);if(isNaN(l)||l<0)return e.status(400).json({error:"Cost per unit must be a valid positive number"});let p=await n.Z.standardCost.findUnique({where:{id:a}});if(!p)return e.status(404).json({error:"Standard cost not found"});if(o!==p.itemName&&await n.Z.standardCost.findUnique({where:{itemName:o}}))return e.status(409).json({error:"A standard cost with this item name already exists"});let f=r?.user?.id?parseInt(r.user.id):null,m=await n.Z.standardCost.update({where:{id:a},data:{itemName:o,description:d,costPerUnit:l,currency:c||"USD",updatedById:f,updatedAt:new Date}});console.log("Standard cost updated successfully:",m.itemName);let h={updated:0,skipped:0};if(p.isActive&&Number(p.costPerUnit)!==l)try{h=await u(o,l)}catch(t){console.error("Error updating production orders:",t)}let w={...m,costPerUnit:Number(m.costPerUnit)};return e.status(200).json({success:!0,data:w,productionOrdersUpdated:h.updated,productionOrdersSkipped:h.skipped})}catch(t){return console.error("Error updating standard cost:",t),e.status(500).json({error:"Failed to update standard cost",details:t instanceof Error?t.message:"Unknown error"})}else if("DELETE"===t.method)try{console.log(`Deactivating standard cost with ID: ${a}`);let t=await n.Z.standardCost.findUnique({where:{id:a}});if(!t)return e.status(404).json({error:"Standard cost not found"});if(!t.isActive)return e.status(400).json({error:"Standard cost is already deactivated"});let r=await n.Z.standardCost.update({where:{id:a},data:{isActive:!1}});return console.log(`Deactivated standard cost with ID: ${a}`),e.status(200).json({message:"Standard cost deactivated successfully",standardCost:r})}catch(t){return console.error("Error deactivating standard cost:",t),e.status(500).json({error:"Failed to deactivate standard cost",details:t instanceof Error?t.message:"Unknown error"})}return e.status(405).json({error:"Method not allowed"})}catch(t){return console.error("Error in handler:",t),e.status(500).json({error:"Failed to process request"})}}async function u(t,e){console.log(`ðŸ”„ Updating production orders for item: ${t} with new cost: $${e}`);try{let r=await n.Z.productionOrder.updateMany({where:{itemName:t,OR:[{costPerUnit:null},{costPerUnit:0}],status:{not:"Completed"}},data:{costPerUnit:e,lastCostUpdate:new Date}});return console.log(`âœ… Updated ${r.count} production orders for ${t} with cost $${e}`),{updated:r.count,skipped:0}}catch(e){return console.error(`âŒ Error updating production orders for ${t}:`,e),{updated:0,skipped:1}}}let c=(0,r(66826).QO)(i),l=(0,d.l)(s,"default"),p=(0,d.l)(s,"config"),f=new a.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/standard-costs/[id]",pathname:"/api/standard-costs/[id]",bundlePath:"",filename:""},userland:s})}};var e=require("../../../webpack-api-runtime.js");e.C(t);var r=t=>e(e.s=t),s=e.X(0,[549],()=>r(574));module.exports=s})();