"use strict";(()=>{var e={};e.id=6084,e.ids=[6084],e.modules={53524:e=>{e.exports=require("@prisma/client")},98432:e=>{e.exports=require("bcryptjs")},57641:e=>{e.exports=require("exceljs")},60614:e=>{e.exports=require("next-auth/jwt")},62113:e=>{e.exports=require("next-auth/next")},47449:e=>{e.exports=require("next-auth/providers/credentials")},41649:e=>{e.exports=require("next-auth/react")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},67597:(e,t,r)=>{r.r(t),r.d(t,{config:()=>m,default:()=>h,routeModule:()=>x});var o={};r.r(o),r.d(o,{default:()=>p});var a=r(71802),s=r(47153),n=r(56249),i=r(66826),d=r(44507),l=r(57641),c=r.n(l);async function u(e,t,r){try{console.log("API: StandardCosts export auth session validated, user:",r?.user?.name);let o=r?.user?.role||"";if("admin"!==o.toLowerCase())return t.status(403).json({error:"Admin access required"});if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});console.log("Exporting standard costs to Excel");let a=await d.Z.standardCost.findMany({orderBy:[{itemName:"asc"}]});console.log(`Found ${a.length} standard costs to export`);let s=new(c()).Workbook,n=s.addWorksheet("Standard Costs");n.columns=[{header:"Item Name",key:"itemName",width:30},{header:"Description",key:"description",width:40},{header:"Cost Per Unit",key:"costPerUnit",width:15},{header:"Currency",key:"currency",width:12},{header:"Status",key:"isActive",width:10},{header:"Created At",key:"createdAt",width:15},{header:"Updated At",key:"updatedAt",width:15}];let i=n.getRow(1);i.font={bold:!0},i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF9CA3AF"}},i.eachCell(e=>{e.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),a.forEach(e=>{n.addRow({itemName:e.itemName,description:e.description||"",costPerUnit:Number(e.costPerUnit),currency:e.currency,isActive:e.isActive?"Active":"Inactive",createdAt:e.createdAt.toLocaleDateString(),updatedAt:e.updatedAt.toLocaleDateString()})}),n.columns.forEach(e=>{e.width=e.width||20});for(let e=2;e<=a.length+1;e++){let t=n.getRow(e);t.eachCell((e,t)=>{e.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},3===t&&(e.numFmt="$#,##0.0000")}),e%2==0&&(t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF9FAFB"}})}console.log("Excel file generated, preparing for download"),t.setHeader("Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),t.setHeader("Content-Disposition","attachment; filename=standard-costs.xlsx");let l=await s.xlsx.writeBuffer();console.log("Excel file written to buffer, sending to client"),t.send(l)}catch(e){console.error("Error exporting standard costs to Excel:",e),t.status(500).json({error:"Failed to export standard costs",message:e instanceof Error?e.message:String(e)})}}let p=(0,i.QO)(u),h=(0,n.l)(o,"default"),m=(0,n.l)(o,"config"),x=new a.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/standard-costs/export",pathname:"/api/standard-costs/export",bundlePath:"",filename:""},userland:o})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[549],()=>r(67597));module.exports=o})();