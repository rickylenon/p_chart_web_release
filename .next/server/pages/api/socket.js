"use strict";(()=>{var e={};e.id=7031,e.ids=[7031],e.modules={20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},29505:e=>{e.exports=import("socket.io")},56249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},54965:(e,t,o)=>{o.a(e,async(e,i)=>{try{o.r(t),o.d(t,{config:()=>l,default:()=>a,routeModule:()=>u});var n=o(71802),r=o(47153),d=o(56249),s=o(44423),c=e([s]);s=(c.then?(await c)():c)[0];let a=(0,d.l)(s,"default"),l=(0,d.l)(s,"config"),u=new n.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/socket",pathname:"/api/socket",bundlePath:"",filename:""},userland:s});i()}catch(e){i(e)}})},44423:(e,t,o)=>{o.a(e,async(e,i)=>{try{let s;o.r(t),o.d(t,{default:()=>d,getIO:()=>c,getSafeIO:()=>a});var n=o(29505),r=e([n]);function d(e,t){if(t.socket.server.io){console.log("Socket server already running"),t.end();return}console.log("Setting up Socket.IO server...");let o=new n.Server(t.socket.server,{path:"/api/socketio",addTrailingSlash:!1,cors:{origin:"*",methods:["GET","POST"],credentials:!0}});t.socket.server.io=o,s=o,o.on("connection",e=>{console.log("Client connected:",e.id),e.on("join-user-room",t=>{t&&(console.log(`User ${t} joined their personal room`),e.join(`user-${t}`))}),e.on("join-role-room",t=>{if(t){let o=t.toLowerCase();console.log(`User joined ${o} room`),e.join(`role-${o}`)}}),e.on("defect-edit-requested",e=>{console.log("Defect edit requested:",e);let t={id:e.requestId||Date.now().toString(),type:"defect-edit",title:"New Defect Edit Request",message:`A defect edit has been requested for ${e.defectCode||"a defect"}`,isRead:!1,createdAt:new Date().toISOString(),linkUrl:"/notifications",sourceId:e.defectId,sourceType:"defect"};o.to("role-admin").emit("notification-defect-edit",t),o.to("role-admin").emit("notification-count-update",{type:"defect-edit"}),console.log("Emitted defect-edit notification to all admins")}),e.on("defect-edit-resolved",e=>{console.log("Defect edit resolved:",e);let t={id:e.responseId||Date.now().toString(),type:"defect-edit",title:"Defect Edit Request Resolved",message:e.approved?"Your defect edit request was approved":"Your defect edit request was rejected",isRead:!1,createdAt:new Date().toISOString(),linkUrl:"/notifications",sourceId:e.defectId,sourceType:"defect"};e.requestedById&&(o.to(`user-${e.requestedById}`).emit("notification-defect-edit",t),o.to(`user-${e.requestedById}`).emit("notification-count-update",{type:"defect-edit"}),console.log(`Emitted defect-edit resolution notification to user ${e.requestedById}`))}),e.on("disconnect",()=>{console.log("Client disconnected:",e.id)})}),console.log("Socket server initialized successfully"),t.end()}n=(r.then?(await r)():r)[0];let c=()=>{if(!s)throw Error("Socket.IO has not been initialized. Call the socket API route first.");return s},a=()=>s||null;i()}catch(e){i(e)}})},47153:(e,t)=>{var o;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},71802:(e,t,o)=>{e.exports=o(20145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var o=t(t.s=54965);module.exports=o})();