"use strict";(()=>{var e={};e.id=6651,e.ids=[6651],e.modules={53524:e=>{e.exports=require("@prisma/client")},98432:e=>{e.exports=require("bcryptjs")},60614:e=>{e.exports=require("next-auth/jwt")},62113:e=>{e.exports=require("next-auth/next")},47449:e=>{e.exports=require("next-auth/providers/credentials")},41649:e=>{e.exports=require("next-auth/react")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},97819:(e,r,t)=>{t.r(r),t.d(r,{config:()=>g,default:()=>p,routeModule:()=>h});var s={};t.r(s),t.d(s,{default:()=>m});var a=t(71802),n=t(47153),o=t(56249),i=t(66826),l=t(44507),u=t(98432),c=t.n(u);async function d(e,r,t){console.log("Admin Users API called");let s=t?.user?.role||"",a="string"==typeof s&&"admin"===s.toLowerCase();if(console.log("User role:",s,"Is admin?",a),!a)return console.log("Non-admin user tried to access user management"),r.status(403).json({error:"Only admin users can manage users"});if("GET"===e.method)try{let t=parseInt(e.query.page)||1,s=parseInt(e.query.limit)||10,a=e.query.search||"",n=e.query.sortField||"username",o=e.query.sortDirection||"asc",i=(t-1)*s;console.log(`Query params: page=${t}, limit=${s}, search=${a}, sortField=${n}, sortDirection=${o}`);let u={};a&&(u={OR:[{username:{contains:a}},{name:{contains:a}},{email:{contains:a}},{role:{contains:a}},{department:{contains:a}}]});let c=await l.Z.user.count({where:u});console.log(`Total matching users: ${c}`);let d={};d[n]=o.toLowerCase();let m=await l.Z.user.findMany({where:u,select:{id:!0,username:!0,name:!0,email:!0,role:!0,isActive:!0,createdAt:!0,lastLogin:!0,department:!0},orderBy:d,skip:i,take:s});return console.log(`Fetched ${m.length} users for page ${t}`),r.status(200).json({users:m,pagination:{total:c,page:t,limit:s,totalPages:Math.ceil(c/s)}})}catch(e){return console.error("Error fetching users:",e),r.status(500).json({error:"Failed to fetch users"})}if("POST"===e.method)try{let{username:t,password:s,name:a,email:n,role:o,department:i,isActive:u}=e.body;if(await l.Z.user.findUnique({where:{username:t}}))return r.status(400).json({error:"Username already exists"});let d=await c().hash(s,10),m=await l.Z.user.create({data:{username:t,password:d,name:a||null,email:n||null,role:o,department:i||null,isActive:u??!0},select:{id:!0,username:!0,name:!0,email:!0,role:!0,isActive:!0,createdAt:!0,lastLogin:!0,department:!0}});return console.log(`Created new user: ${t}`),r.status(201).json(m)}catch(e){return console.error("Error creating user:",e),r.status(500).json({error:"Failed to create user"})}return r.status(405).json({error:"Method not allowed"})}let m=(0,i.QO)(d),p=(0,o.l)(s,"default"),g=(0,o.l)(s,"config"),h=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/admin/users",pathname:"/api/admin/users",bundlePath:"",filename:""},userland:s})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[549],()=>t(97819));module.exports=s})();