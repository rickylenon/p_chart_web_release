exports.id=5143,exports.ids=[5143],exports.modules={30072:(e,t,i)=>{"use strict";i.a(e,async(e,o)=>{try{i.d(t,{T:()=>g});var s=i(20997),n=i(16689),r=i(87249),a=i(37622),l=i(51853),c=i(45077),d=i(79231),u=e([r,a]);[r,a]=u.then?(await u)():u;let g=({isOpen:e,onContinue:t,onLogout:o,timeRemaining:u,className:g=""})=>{let m=(0,d.YV)(),h=e??m?.showWarning??!1,f=u??m?.timeRemaining??0,p=t??m?.extendSession,[v,y]=(0,n.useState)(""),[x,b]=(0,n.useState)(!1),w=(0,n.useCallback)(e=>{let t=Math.max(0,Math.ceil(e/1e3));return`${Math.floor(t/60).toString().padStart(2,"0")}:${(t%60).toString().padStart(2,"0")}`},[]);(0,n.useEffect)(()=>{y(w(f)),b(f<6e4)},[f,w]);let S=(0,n.useCallback)(()=>{console.log("[IdleWarningModal] User chose to continue session"),p&&p()},[p]),T=(0,n.useCallback)(async()=>{console.log("[IdleWarningModal] User chose to logout immediately");try{if(o)o();else{let{UserSession:e}=await Promise.resolve().then(i.bind(i,98225));e?.clearSession&&e.clearSession();let{signOut:t}=await Promise.resolve().then(i.t.bind(i,41649,23));await t({redirect:!1}),setTimeout(()=>{window.location.href="/auth/login?expired=true"},100)}}catch(e){console.error("[IdleWarningModal] Error during logout:",e),window.location.href="/auth/login?expired=true"}},[o]);return((0,n.useEffect)(()=>{let e=e=>{"Escape"===e.key&&h&&S()};if(h)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[h,S]),h)?s.jsx(a.Vq,{open:h,onOpenChange:e=>!e&&S(),children:(0,s.jsxs)(a.cZ,{className:`sm:max-w-md ${g}`,onInteractOutside:e=>e.preventDefault(),onEscapeKeyDown:S,children:[s.jsx(a.fK,{children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-2 rounded-full ${x?"bg-red-100":"bg-yellow-100"}`,children:x?s.jsx(l.Z,{className:`h-6 w-6 ${x?"text-red-600":"text-yellow-600"}`}):s.jsx(c.Z,{className:`h-6 w-6 ${x?"text-red-600":"text-yellow-600"}`})}),s.jsx(a.$N,{className:`text-lg font-semibold ${x?"text-red-900":"text-yellow-900"}`,children:"Session Timeout Warning"})]})}),s.jsx(a.Be,{className:"text-center py-4",children:(0,s.jsxs)("div",{className:"space-y-3",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Your session will expire due to inactivity in:"}),s.jsx("div",{className:`text-4xl font-mono font-bold ${x?"text-red-600":"text-yellow-600"}`,children:v}),s.jsx("p",{className:"text-sm text-muted-foreground",children:x?"Please choose an action immediately to avoid being logged out.":"Would you like to continue your session?"})]})}),(0,s.jsxs)(a.cN,{className:"flex justify-center gap-3 sm:justify-center",children:[s.jsx(r.z,{variant:"outline",onClick:T,className:"min-w-[100px]",children:"Logout Now"}),s.jsx(r.z,{onClick:S,className:`min-w-[120px] ${x?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-primary hover:bg-primary/90"}`,autoFocus:!0,children:"Continue Session"})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-4",children:s.jsx("div",{className:`h-2 rounded-full transition-all duration-1000 ${x?"bg-red-500":"bg-yellow-500"}`,style:{width:`${Math.max(0,Math.min(100,f/3e5*100))}%`}})})]})}):null};o()}catch(e){o(e)}})},70749:(e,t,i)=>{"use strict";i.d(t,{F:()=>l,f:()=>a});var o=i(20997),s=i(16689);let n=(0,s.createContext)({theme:"light",setTheme:()=>null});function r(){return"light"}function a({children:e}){let[t,i]=(0,s.useState)(r),[a,l]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{l(!0);let e=window.matchMedia("(prefers-color-scheme: dark)"),t=e=>{localStorage.getItem("theme")||(console.log("ThemeProvider: System theme changed to:",e.matches?"dark":"light"),i(e.matches?"dark":"light"))};return e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[]),(0,s.useEffect)(()=>{if(!a)return;let e=window.document.documentElement;e.classList.remove("light","dark"),e.classList.add(t),localStorage.setItem("theme",t),console.log("ThemeProvider: Theme changed and stored:",t)},[t,a]),o.jsx(n.Provider,{value:{theme:t,setTheme:e=>{console.log("ThemeProvider: Setting theme to:",e),i(e)}},children:e})}let l=()=>{let e=(0,s.useContext)(n);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},87249:(e,t,i)=>{"use strict";i.a(e,async(e,o)=>{try{i.d(t,{d:()=>d,z:()=>u});var s=i(20997),n=i(16689),r=i(14338),a=i(16926),l=i(32676),c=e([r,a,l]);[r,a,l]=c.then?(await c)():c;let d=(0,a.cva)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),u=n.forwardRef(({className:e,variant:t,size:i,asChild:o=!1,...n},a)=>{let c=o?r.Slot:"button";return s.jsx(c,{className:(0,l.cn)(d({variant:t,size:i,className:e})),ref:a,...n})});u.displayName="Button",o()}catch(e){o(e)}})},29977:(e,t,i)=>{"use strict";i.a(e,async(e,o)=>{try{i.d(t,{I:()=>a});var s=i(20997);i(16689);var n=i(86201),r=e([n]);n=(r.then?(await r)():r)[0];let l=({title:e,message:t,action:i,t:o})=>(0,s.jsxs)("div",{className:`${o.visible?"animate-enter":"animate-leave"} max-w-sm w-full bg-white dark:bg-gray-800 shadow-md rounded-lg pointer-events-auto flex ring-1 ring-black ring-opacity-5`,children:[s.jsx("div",{className:"flex-1 w-0 p-3",children:s.jsx("div",{className:"flex items-start",children:(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("p",{className:"text-xs font-medium text-gray-900 dark:text-gray-100",children:e}),s.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400 truncate",children:t})]})})}),i&&s.jsx("button",{onClick:()=>{n.toast.dismiss(o.id),i.onClick()},className:"p-2 border-l border-gray-200 dark:border-gray-700 text-xs font-medium text-blue-600 hover:text-blue-500 focus:outline-none",children:i.label})]});function a(e,t,i,o){return n.toast.custom(o=>s.jsx(l,{title:e,message:t,action:i,t:o}),{duration:o?.duration||4e3,id:o?.id})}o()}catch(e){o(e)}})},37622:(e,t,i)=>{"use strict";i.a(e,async(e,o)=>{try{i.d(t,{$N:()=>p,Be:()=>v,Vq:()=>d,cN:()=>f,cZ:()=>m,fK:()=>h});var s=i(20997),n=i(16689),r=i(77715),a=i(41352),l=i(32676),c=e([r,l]);[r,l]=c.then?(await c)():c;let d=r.Root;r.Trigger;let u=r.Portal;r.Close;let g=n.forwardRef(({className:e,...t},i)=>s.jsx(r.Overlay,{ref:i,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));g.displayName=r.Overlay.displayName;let m=n.forwardRef(({className:e,children:t,...i},o)=>(0,s.jsxs)(u,{children:[s.jsx(g,{}),(0,s.jsxs)(r.Content,{ref:o,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...i,children:[t,(0,s.jsxs)(r.Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[s.jsx(a.Z,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));m.displayName=r.Content.displayName;let h=({className:e,...t})=>s.jsx("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});h.displayName="DialogHeader";let f=({className:e,...t})=>s.jsx("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});f.displayName="DialogFooter";let p=n.forwardRef(({className:e,...t},i)=>s.jsx(r.Title,{ref:i,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",e),...t}));p.displayName=r.Title.displayName;let v=n.forwardRef(({className:e,...t},i)=>s.jsx(r.Description,{ref:i,className:(0,l.cn)("text-sm text-muted-foreground",e),...t}));v.displayName=r.Description.displayName,o()}catch(e){o(e)}})},29422:(e,t,i)=>{"use strict";i.a(e,async(e,o)=>{try{i.d(t,{FN:()=>h,Mi:()=>p,VW:()=>u,_i:()=>g,lj:()=>v,sA:()=>f});var s=i(20997),n=i(16689),r=i(61329),a=i(16926),l=i(41352),c=i(32676),d=e([r,a,c]);[r,a,c]=d.then?(await d)():d;let u=r.Provider,g=n.forwardRef(({className:e,...t},i)=>s.jsx(r.Viewport,{ref:i,className:(0,c.cn)("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));g.displayName=r.Viewport.displayName;let m=(0,a.cva)("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),h=n.forwardRef(({className:e,variant:t,...i},o)=>s.jsx(r.Root,{ref:o,className:(0,c.cn)(m({variant:t}),e),...i}));h.displayName=r.Root.displayName,n.forwardRef(({className:e,...t},i)=>s.jsx(r.Action,{ref:i,className:(0,c.cn)("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t})).displayName=r.Action.displayName;let f=n.forwardRef(({className:e,...t},i)=>s.jsx(r.Close,{ref:i,className:(0,c.cn)("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:s.jsx(l.Z,{className:"h-4 w-4"})}));f.displayName=r.Close.displayName;let p=n.forwardRef(({className:e,...t},i)=>s.jsx(r.Title,{ref:i,className:(0,c.cn)("text-sm font-semibold",e),...t}));p.displayName=r.Title.displayName;let v=n.forwardRef(({className:e,...t},i)=>s.jsx(r.Description,{ref:i,className:(0,c.cn)("text-sm opacity-90",e),...t}));v.displayName=r.Description.displayName,o()}catch(e){o(e)}})},77646:(e,t,i)=>{"use strict";i.a(e,async(e,o)=>{try{i.d(t,{x:()=>l});var s=i(20997),n=i(29422),r=i(65050),a=e([n]);function l(){let{toasts:e}=(0,r.pm)();return(0,s.jsxs)(n.VW,{children:[e.map(function({id:e,title:t,description:i,action:o,...r}){return(0,s.jsxs)(n.FN,{...r,children:[(0,s.jsxs)("div",{className:"grid gap-1",children:[t&&s.jsx(n.Mi,{children:t}),i&&s.jsx(n.lj,{children:i})]}),o,s.jsx(n.sA,{})]},e)}),s.jsx(n._i,{})]})}n=(a.then?(await a)():a)[0],o()}catch(e){o(e)}})},65050:(e,t,i)=>{"use strict";i.d(t,{Am:()=>u,pm:()=>g});var o=i(16689);let s=0,n=new Map,r=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},a=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:i}=t;return i?r(i):e.toasts.forEach(e=>{r(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===i||void 0===i?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],c={toasts:[]};function d(e){c=a(c,e),l.forEach(e=>{e(c)})}function u({...e}){let t=(s=(s+1)%Number.MAX_VALUE).toString(),i=()=>d({type:"DISMISS_TOAST",toastId:t});return d({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||i()}}}),{id:t,dismiss:i,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function g(){let[e,t]=o.useState(c);return o.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},79231:(e,t,i)=>{"use strict";i.d(t,{md:()=>u,YV:()=>d});var o=i(20997),s=i(16689),n=i(41649);class r{static{this.DEFAULT_ACTIVITY_EVENTS=["mousemove","mousedown","click","keydown","keypress","touchstart","touchmove","focus","blur","visibilitychange"]}constructor(e={}){this.lastActivity=new Date,this.debounceTimer=null,this.eventListenersAttached=!1,this.handleActivity=e=>{this.enabled&&(this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{let t=new Date;this.lastActivity=t,console.log("[ActivityTracker] Activity detected:",{eventType:e?.type||"manual",timestamp:t.toISOString(),timeSinceLastActivity:t.getTime()-this.lastActivity.getTime()}),this.onActivityCallback()},this.debounceMs))},this.handleVisibilityChange=()=>{this.enabled&&(document.hidden?console.log("[ActivityTracker] Page became hidden"):(console.log("[ActivityTracker] Page became visible"),this.handleActivity()))},this.debounceMs=e.debounceMs??1e3,this.activityEvents=e.activityEvents??r.DEFAULT_ACTIVITY_EVENTS,this.onActivityCallback=e.onActivity??(()=>{}),this.enabled=e.enabled??!0,console.log("[ActivityTracker] Initialized with options:",{debounceMs:this.debounceMs,eventsCount:this.activityEvents.length,enabled:this.enabled})}start(){this.enabled&&!this.eventListenersAttached&&(console.log("[ActivityTracker] Starting activity tracking..."),this.activityEvents.forEach(e=>{"visibilitychange"===e?document.addEventListener(e,this.handleVisibilityChange,{passive:!0}):document.addEventListener(e,this.handleActivity,{passive:!0})}),this.eventListenersAttached=!0,this.lastActivity=new Date,console.log("[ActivityTracker] Activity tracking started with events:",this.activityEvents))}stop(){this.eventListenersAttached&&(console.log("[ActivityTracker] Stopping activity tracking..."),this.activityEvents.forEach(e=>{"visibilitychange"===e?document.removeEventListener(e,this.handleVisibilityChange):document.removeEventListener(e,this.handleActivity)}),this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),this.eventListenersAttached=!1,console.log("[ActivityTracker] Activity tracking stopped"))}getIdleTime(){let e=Date.now()-this.lastActivity.getTime();return console.log("[ActivityTracker] Current idle time:",{idleTimeMs:e,idleTimeMinutes:Math.floor(e/6e4),lastActivity:this.lastActivity.toISOString()}),e}isIdle(e){let t=this.getIdleTime(),i=t>e;return console.log("[ActivityTracker] Idle check:",{idleTimeMs:t,timeoutMs:e,isIdle:i,remainingMs:Math.max(0,e-t)}),i}getTimeRemaining(e){return Math.max(0,e-this.getIdleTime())}resetActivity(){console.log("[ActivityTracker] Manually resetting activity timer"),this.lastActivity=new Date,this.onActivityCallback()}getLastActivity(){return new Date(this.lastActivity)}setEnabled(e){console.log("[ActivityTracker] Setting enabled:",e),this.enabled=e,!e&&this.eventListenersAttached?this.stop():e&&!this.eventListenersAttached&&this.start()}setOnActivity(e){console.log("[ActivityTracker] Updating activity callback"),this.onActivityCallback=e}destroy(){console.log("[ActivityTracker] Destroying activity tracker..."),this.stop()}}var a=i(98225);let l={idleTimeout:6e4*parseInt(process.env.NEXT_PUBLIC_IDLE_TIMEOUT_MINUTES||"30"),warningTime:6e4*parseInt(process.env.NEXT_PUBLIC_IDLE_WARNING_MINUTES||"5"),checkInterval:1e3*parseInt(process.env.NEXT_PUBLIC_IDLE_CHECK_INTERVAL_SECONDS||"60"),activityDebounce:1e3,activityEvents:["mousemove","mousedown","click","keydown","keypress","touchstart","touchmove","focus","blur","visibilitychange"],showWarningModal:!0,showStatusIndicator:!1,roleTimeouts:{admin:6e4*parseInt(process.env.NEXT_PUBLIC_IDLE_ADMIN_TIMEOUT_MINUTES||"30"),encoder:6e4*parseInt(process.env.NEXT_PUBLIC_IDLE_ENCODER_TIMEOUT_MINUTES||"15"),viewer:6e4*parseInt(process.env.NEXT_PUBLIC_IDLE_VIEWER_TIMEOUT_MINUTES||"5"),user:6e4*parseInt(process.env.NEXT_PUBLIC_IDLE_TIMEOUT_MINUTES||"30")},enabled:"true"!==process.env.NEXT_PUBLIC_DISABLE_IDLE_TIMEOUT_DEV||!0,debugMode:!1},c=(0,s.createContext)(void 0),d=()=>{let e=(0,s.useContext)(c);if(void 0===e)throw Error("useIdleTimeout must be used within an IdleTimeoutProvider");return e},u=({children:e,initialConfig:t={}})=>{let{data:d}=(0,n.useSession)(),[u,g]=(0,s.useState)(()=>({...l,...t})),[m,h]=(0,s.useState)(!1),[f,p]=(0,s.useState)(!1),[v,y]=(0,s.useState)(0),[x,b]=(0,s.useState)(new Date),[w,S]=(0,s.useState)(null),[T,C]=(0,s.useState)(null),N=u.enabled&&!!d?.user,k=(0,s.useCallback)(()=>{let e=d?.user?.role?.toLowerCase()||"user";return u.roleTimeouts[e]||u.idleTimeout},[d?.user,u.roleTimeouts,u.idleTimeout]),I=(0,s.useCallback)(()=>{let e=k(),t=d?.user?.role?.toLowerCase()||"user";return"viewer"===t?Math.min(12e4,.4*e):"encoder"===t?Math.min(3e5,.33*e):Math.min(u.warningTime,.25*e)},[k,d?.user,u.warningTime]),E=(0,s.useCallback)(e=>{let t=I();return{showWarning:e<=t&&e>0,isIdle:e<=0,warningProgress:Math.max(0,(t-e)/t)}},[I]),A=(0,s.useCallback)(()=>{if(!N)return;let e=new Date;b(e),a.UserSession?.updateLastActivity&&a.UserSession.updateLastActivity(),u.debugMode&&console.log("[IdleTimeout] Activity detected:",e.toISOString()),(f||m)&&(p(!1),h(!1))},[N,u.debugMode,f,m]),j=(0,s.useCallback)(()=>{u.debugMode&&console.log("[IdleTimeout] Timer reset manually"),A()},[A,u.debugMode]),R=(0,s.useCallback)(async()=>{try{u.debugMode&&console.log("[IdleTimeout] Extending session..."),j(),d&&a.UserSession.updateLastActivity(),console.log("[IdleTimeout] Session extended successfully")}catch(t){console.error("[IdleTimeout] Failed to extend session:",t);let{UserSession:e}=await Promise.resolve().then(i.bind(i,98225));e?.clearSession&&e.clearSession()}},[j,d,u.debugMode]),U=(0,s.useCallback)(e=>{u.debugMode&&console.log("[IdleTimeout] Updating configuration:",e),g(t=>({...t,...e}))},[u.debugMode]),M=(0,s.useCallback)(async()=>{try{console.log("[IdleTimeout] User idle timeout - logging out");let{UserSession:e}=await Promise.resolve().then(i.bind(i,98225));e?.clearSession&&e.clearSession();let{signOut:t}=await Promise.resolve().then(i.t.bind(i,41649,23));await t({redirect:!1}),setTimeout(()=>{window.location.href="/auth/login?expired=true"},100)}catch(e){console.error("[IdleTimeout] Error during idle logout:",e),window.location.href="/auth/login?expired=true"}},[]),L=(0,s.useCallback)(()=>{if(!N||!w)return;let e=k(),t=w.getTimeRemaining(e),i=E(t);y(t),p(i.showWarning),i.isIdle&&!m&&(h(!0),M()),u.debugMode&&console.log("[IdleTimeout] Status check:",{timeRemaining:t,showWarning:i.showWarning,isIdle:i.isIdle,roleTimeout:e,warningTime:I(),userRole:d?.user?.role?.toLowerCase()||"user"})},[N,w,k,E,m,M,u.debugMode,d?.user]);return(0,s.useEffect)(()=>{if(N&&d?.user){let e=localStorage.getItem("p_chart_last_activity"),t=d.user?.id;if(e)try{let i=JSON.parse(e);if(i.userId&&i.timestamp){if(i.userId===t){let e=new Date(i.timestamp);isNaN(e.getTime())?(console.log("[IdleTimeout] Invalid activity timestamp for current user, resetting"),a.UserSession.updateLastActivity(),b(new Date)):(console.log("[IdleTimeout] Using existing activity for current user:",{userId:i.userId,timestamp:e.toISOString()}),b(e))}else console.log("[IdleTimeout] Activity belongs to different user, resetting for new user"),localStorage.removeItem("p_chart_last_activity"),a.UserSession.updateLastActivity(),b(new Date)}else console.log("[IdleTimeout] Invalid activity data format, resetting"),a.UserSession.updateLastActivity(),b(new Date)}catch(t){try{let t=new Date(e);isNaN(t.getTime())?(console.log("[IdleTimeout] Invalid old format timestamp, resetting"),a.UserSession.updateLastActivity(),b(new Date)):(console.log("[IdleTimeout] Converting old format timestamp to new format"),b(t),a.UserSession.updateLastActivity())}catch(e){console.log("[IdleTimeout] Error parsing activity timestamp, resetting"),a.UserSession.updateLastActivity(),b(new Date)}}else console.log("[IdleTimeout] No initial activity found, setting current time"),a.UserSession.updateLastActivity(),b(new Date)}},[N,d?.user?.id]),(0,s.useEffect)(()=>{if(!N){w&&(w.destroy(),S(null));return}if(!w){u.debugMode&&console.log("[IdleTimeout] Initializing activity tracker...");let e=new r({debounceMs:u.activityDebounce,activityEvents:u.activityEvents,onActivity:A,enabled:!0});e.start(),S(e)}return()=>{}},[N]),(0,s.useEffect)(()=>{w&&A&&w.setOnActivity(A)},[w,A]),(0,s.useEffect)(()=>{if(!N){T&&(clearInterval(T),C(null));return}let e=setInterval(L,u.checkInterval);return C(e),L(),()=>{clearInterval(e)}},[N,u.checkInterval,L]),(0,s.useEffect)(()=>()=>{w&&w.destroy(),T&&clearInterval(T)},[]),u.debugMode&&console.log("[IdleTimeout] Provider render:",{isEnabled:N,isIdle:m,showWarning:f,timeRemaining:v,hasSession:!!d}),o.jsx(c.Provider,{value:{config:u,isIdle:m,showWarning:f,timeRemaining:v,lastActivity:x,resetTimer:j,extendSession:R,updateConfig:U,isEnabled:N},children:e})}},59165:(e,t,i)=>{"use strict";i.a(e,async(e,o)=>{try{i.d(t,{JB:()=>f,lm:()=>g});var s=i(20997),n=i(16689),r=i(41649),a=i(75717),l=i(29977),c=i(35339),d=e([a,l,c]);[a,l,c]=d.then?(await d)():d;let u=(0,n.createContext)({notifications:[],unreadCount:{total:0,byType:{}},socket:null,isConnected:!1,emit:()=>{},subscribe:()=>()=>{},fetchNotifications:async()=>{},markAsRead:async()=>{},registerNotificationHandler:()=>{}}),g=()=>(0,n.useContext)(u),m=new Set,h=e=>{let t=`notification-${e.id}`;if(m.has(t)||m.size>=3)return;m.add(t);let i=e.linkUrl?{label:"View",onClick:()=>{window.location.href=e.linkUrl}}:void 0;(0,l.I)(e.title,e.message,i,{duration:4e3,id:t}),setTimeout(()=>{m.delete(t)},4500)},f=({children:e})=>{let[t,i]=(0,n.useState)([]),[o,l]=(0,n.useState)({total:0,byType:{}}),{data:d}=(0,r.useSession)(),g=d?.user,{socket:m,isConnected:f,subscribe:p,emit:v}=(0,a.Z)(),y=(0,n.useRef)({}),x=(0,n.useRef)({isSetup:!1,cleanupFunctions:[]}),b=(0,n.useRef)(!1),w=(0,n.useRef)(!1),S=(0,n.useCallback)(async e=>{if(g?.id&&!b.current)try{console.log("NotificationContext: Fetching notifications",e?`for type: ${e}`:"");let t=new URLSearchParams;t.append("count","true"),e&&t.append("type",e);let o=await c.Z.get(`/api/notifications?${t.toString()}`);if(o.data){console.log("NotificationContext: Received notification counts:",o.data);let e=o.data;l({total:e.unread??0,byType:e.byType??{}})}let s=new URLSearchParams;s.append("limit","50"),e&&s.append("type",e);let n=await c.Z.get(`/api/notifications?${s.toString()}`);if(n.data){let e=n.data;e.notifications&&e.notifications.length>0?(console.log("NotificationContext: Received notifications data:",e.notifications.length,"notifications"),i(e.notifications)):(console.log("NotificationContext: No notifications received"),i([]))}}catch(e){console.error("NotificationContext: Error fetching notifications:",e)}},[g?.id]),T=(0,n.useCallback)(async(e,o,s)=>{if(g?.id)try{console.log("NotificationContext: Marking notifications as read",{id:e,type:o,all:s});let n={};e&&(n.id=e),o&&(n.type=o),s&&(n.all=!0);let r=await c.Z.put("/api/notifications",n);r.data&&(console.log("NotificationContext: Marked as read response:",r.data),await S(),e&&t.length>0?i(t=>t.map(t=>t.id===e?{...t,isRead:!0}:t)):(o||s)&&t.length>0&&i(e=>e.map(e=>s||e.type===o?{...e,isRead:!0}:e)))}catch(e){console.error("NotificationContext: Error marking as read:",e)}},[g?.id,S]),C=(0,n.useCallback)((e,t)=>{console.log(`NotificationContext: Registering handler for ${e} notifications`),y.current[e]=t},[]),N=(0,n.useCallback)((e,t)=>{console.log(`NotificationContext: Received ${e} event:`,t);let i=e.replace("notification-",""),o=y.current[i];o?o(t):h(t)},[]);return(0,n.useEffect)(()=>{g?.id&&!w.current&&(console.log("NotificationContext: Initial notification fetch after session load"),w.current=!0,setTimeout(()=>{S()},500))},[g?.id,S]),(0,n.useEffect)(()=>{g?.id&&f&&m&&(console.log("NotificationContext: User authenticated, setting up socket rooms"),v("join-user-room",g.id),console.log(`Joined user room for user ID: ${g.id}`),g.role&&(v("join-role-room",g.role),console.log(`Joined role room: ${g.role}`)),setTimeout(()=>{S()},100))},[g?.id,g?.role,f,m,v,S]),(0,n.useEffect)(()=>{if(!f||!m||x.current.isSetup)return;x.current.isSetup=!0,console.log("NotificationContext: Setting up notification event listeners"),x.current.cleanupFunctions.length>0&&(console.log("NotificationContext: Cleaning up existing subscriptions first"),x.current.cleanupFunctions.forEach(e=>e()),x.current.cleanupFunctions=[]);let e=p("notification-count-update",e=>{console.log("NotificationContext: Received notification count update event",e),setTimeout(()=>{S(e?.type)},100)});return x.current.cleanupFunctions.push(e),["defect-edit","system","message"].forEach(e=>{let t=`notification-${e}`;console.log(`NotificationContext: Setting up subscription for ${t}`);let i=p(t,e=>{N(t,e)});x.current.cleanupFunctions.push(i)}),()=>{console.log("NotificationContext: Cleaning up event subscriptions"),x.current.isSetup=!1,x.current.cleanupFunctions.forEach(e=>e()),x.current.cleanupFunctions=[]}},[f,m]),s.jsx(u.Provider,{value:{notifications:t,unreadCount:o,socket:m,isConnected:f,emit:v,subscribe:p,fetchNotifications:S,markAsRead:T,registerNotificationHandler:C},children:e})};o()}catch(e){o(e)}})},75717:(e,t,i)=>{"use strict";i.a(e,async(e,o)=>{try{i.d(t,{Z:()=>l});var s=i(16689),n=i(41649),r=i(14612),a=e([r]);function l(e=""){let[t,i]=(0,s.useState)(null),[o,a]=(0,s.useState)(!1),[l,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(!0),{data:g,status:m}=(0,n.useSession)();(0,s.useEffect)(()=>{if("loading"===m){console.log("useSocket: Session still loading, waiting...");return}if("unauthenticated"===m||!g?.user?.id){console.log("useSocket: No authenticated user, skipping socket initialization"),u(!1);return}console.log("useSocket: Initializing socket connection for authenticated user...");let e=null;return fetch("/api/socket").then(()=>{console.log("useSocket: Socket server initialized, creating connection"),(e=(0,r.io)({path:"/api/socketio",reconnectionAttempts:5,reconnectionDelay:1e3})).on("connect",()=>{console.log("useSocket: Socket connected successfully:",e.id),a(!0),u(!1)}),e.on("connect_error",e=>{console.error("useSocket: Socket connection error:",e.message),u(!1)}),e.on("disconnect",()=>{console.log("useSocket: Socket disconnected"),a(!1)}),i(e)}).catch(e=>{console.error("useSocket: Failed to initialize socket server:",e),u(!1)}),()=>{console.log("useSocket: Cleaning up socket connection"),e&&e.disconnect()}},[g?.user?.id,m]);let h=(0,s.useCallback)((e,i)=>t?(console.log(`useSocket: Subscribing to ${e} event`),t.on(e,t=>{console.log(`useSocket: Received ${e} event:`,t),c({event:e,data:t}),i(t)}),()=>{console.log(`useSocket: Unsubscribing from ${e} event`),t.off(e)}):(console.warn(`useSocket: Cannot subscribe to ${e}: socket not initialized`),()=>{}),[t]),f=(0,s.useCallback)((e,i)=>{if(!t){console.warn("useSocket: Cannot emit event: socket not initialized");return}if(!o){console.warn("useSocket: Cannot emit event: socket not connected");return}console.log(`useSocket: Emitting ${e} event:`,i),t.emit(e,i)},[t,o]);return{socket:t,isConnected:o,isInitializing:d,lastMessage:l,subscribe:h,emit:f}}r=(a.then?(await a)():a)[0],o()}catch(e){o(e)}})},83143:(e,t,i)=>{"use strict";function o(){return function(e=""){let t=process.env.VERCEL_URL?`https://${process.env.VERCEL_URL}`:"http://localhost:3000",i=e.startsWith("/")?e:`/${e}`;return`${t}/api/auth${i}`}("/session")}function s(){return{refetchInterval:1800,refetchOnWindowFocus:!0,refetchWhenOffline:!1,debug:"true"===process.env.NEXTAUTH_DEBUG}}i.d(t,{GO:()=>o,aA:()=>s})},35339:(e,t,i)=>{"use strict";i.a(e,async(e,o)=>{try{i.d(t,{Z:()=>l});var s=i(99648),n=i(98225),r=e([s]);let a=(s=(r.then?(await r)():r)[0]).default.create({baseURL:process.env.NEXT_PUBLIC_API_URL||"",timeout:1e4});a.interceptors.request.use(e=>{let t=n.UserSession.getAuthHeaders();return e.headers||(e.headers={}),Object.keys(t).forEach(i=>{e.headers[i]=t[i]}),console.log("Adding auth headers to request:",t),e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>(console.error(" API request failed:",e.config?.url,e.response?.status),e.response?.status===401&&(console.log("Authentication error, clearing stale session data and redirecting to login..."),n.UserSession.clearSession()),Promise.reject(e)));let l=a;o()}catch(e){o(e)}})},98225:(e,t,i)=>{"use strict";i.d(t,{QO:()=>d,UserSession:()=>c,c2:()=>u,ri:()=>g});var o=i(20997),s=i(41649),n=i(11163),r=i(16689),a=i(83143);let l=e=>{let t=e.toLowerCase(),i=t.charAt(0).toUpperCase()+t.slice(1);return console.log(`[Client] Role normalization: ${e} -> ${i}`),i},c={storeSession:e=>{},getSession:()=>null,clearSession:()=>{},getAuthHeaders:()=>{let e={"Content-Type":"application/json"};try{console.log("[Client] Building auth headers...");let t=c.getSession();if(t?.id){let i=l(t.role||"User");console.log("[Client] Adding auth headers with user data:",{userId:t.id,role:i}),e["X-User-Id"]=String(t.id),e["X-User-Role"]=i,e.Authorization=`Bearer ${t.id}`}else console.warn("[Client] No user session found for auth headers")}catch(e){console.error("[Client] Error building auth headers:",e)}return e},getCurrentUser:async()=>{let e=c.getSession();if(e)return e;try{console.log("[Client] ====== GET CURRENT USER DEBUG ====="),console.log("[Client] Fetching current user data from server"),console.log("[Client] Document cookies:",document.cookie);let e=(0,a.GO)();console.log("[Client] Session URL:",e);let t=await fetch(e,{credentials:"include",headers:{"Content-Type":"application/json"}});console.log("[Client] Session response status:",t.status),console.log("[Client] Session response headers:",Object.fromEntries([...t.headers.entries()]));let i=await t.json();if(console.log("[Client] Session response data:",i),console.log("[Client] Session has user data:",!!i?.user),console.log("[Client] ====== END GET CURRENT USER DEBUG ====="),i?.user)return c.storeSession(i.user),i.user;return null}catch(e){return console.error("[Client] Error fetching current user:",e),console.error("[Client] Error details:",e),null}},hasRole:e=>{let t=c.getSession();if(!t?.role)return console.log("[Client] Role check failed - No user data or role found"),!1;let i=l(t.role),o=l(e);return console.log("[Client] Role check:",{userRole:i,requiredRole:o,hasRole:i===o}),i===o},updateLastActivity:()=>{},getLastActivity:()=>null,isSessionExpiredByIdle:e=>{let t=c.getLastActivity();if(!t)return console.log("[Client] No last activity found - considering expired"),!0;let i=Date.now()-t.getTime(),o=i>e;return console.log("[Client] Idle timeout check:",{lastActivity:t.toISOString(),idleTimeMs:i,timeoutMs:e,isExpired:o}),o},getIdleTimeRemaining:e=>{let t=c.getLastActivity();if(!t)return console.log("[Client] No last activity found - no time remaining"),0;let i=Date.now()-t.getTime(),o=Math.max(0,e-i);return console.log("[Client] Idle time remaining:",{lastActivity:t.toISOString(),idleTimeMs:i,timeoutMs:e,remainingMs:o}),o}};function d(e,t){let i=i=>{let{data:a,status:d}=(0,s.useSession)(),u=(0,n.useRouter)(),g="loading"===d,m=!!a?.user,h=l(a?.user?.role||"User");return((0,r.useEffect)(()=>{if(console.log("[Client] Auth HOC state:",{loading:g,isAuthenticated:m,userRole:h,requiredRole:t,status:d}),!g){if(m&&a?.user&&(console.log("[Client] Storing authenticated session:",a.user),c.storeSession(a.user)),!m){let e=window.location.href;console.log("[Client] Redirecting to login:",{currentUrl:e,callbackUrl:`/auth/login?callbackUrl=${encodeURIComponent(e)}`}),u.push(`/auth/login?callbackUrl=${encodeURIComponent(e)}`);return}t&&l(h)!==l(t)&&(console.log("[Client] Insufficient role:",{required:l(t),current:l(h)}),u.push("/dashboard"))}},[g,m,h,u,a]),g||!m||t&&l(h)!==l(t))?(console.log("[Client] Showing loading state:",{loading:g,isAuthenticated:m,roleCheck:!t||l(h)===l(t)}),o.jsx("div",{className:"flex items-center justify-center min-h-screen",children:o.jsx("div",{className:"animate-pulse text-gray-400",children:"Loading..."})})):(console.log("[Client] Rendering protected component"),o.jsx(e,{...i}))};return i.displayName=`withAuth(${e.displayName||e.name||"Component"})`,i}function u(e){return d(e,"Admin")}let g=async(e,t={})=>{console.log("[Client] Making authenticated fetch request to:",e);let i=c.getAuthHeaders();console.log("[Client] Using auth headers:",i);let o={...i,...t.headers||{}};console.log("[Client] Final fetch configuration:",{url:e,method:t.method||"GET",headers:JSON.stringify(o),credentials:"include"});try{let i=await fetch(e,{...t,headers:o,credentials:"include"});switch(console.log("[Client] Fetch response status:",i.status),i.status){case 401:console.error("[Client] Session expired (401 Unauthorized)"),c.clearSession();let s=window.location.href;return window.location.href=`/auth/login?callbackUrl=${encodeURIComponent(s)}&expired=true`,new Response(JSON.stringify({error:"Session expired"}),{status:401});case 403:return console.error("[Client] Permission denied (403 Forbidden)"),new Response(JSON.stringify({error:"You do not have permission to access this resource",status:"permission_denied"}),{status:403});case 429:console.error("[Client] Rate limited (429 Too Many Requests)");let n=i.headers.get("Retry-After")||"5";return console.log(`[Client] Should retry after ${n} seconds`),new Response(JSON.stringify({error:"Rate limit exceeded. Please try again later.",retryAfter:n}),{status:429});case 500:case 502:case 503:case 504:return console.error(`[Client] Server error (${i.status})`),new Response(JSON.stringify({error:"The server encountered an error. Please try again later.",status:"server_error",code:i.status}),{status:i.status})}return i}catch(e){if(console.error("[Client] Fetch error:",e),e instanceof TypeError&&e.message.includes("fetch"))return console.error("[Client] Network error - unable to reach server"),new Response(JSON.stringify({error:"Network error. Please check your connection.",status:"network_error"}),{status:0});throw e}}},32676:(e,t,i)=>{"use strict";i.a(e,async(e,o)=>{try{i.d(t,{cn:()=>a});var s=i(16593),n=i(68097),r=e([s,n]);function a(...e){return(0,n.twMerge)((0,s.clsx)(e))}[s,n]=r.then?(await r)():r,o()}catch(e){o(e)}})},65143:(e,t,i)=>{"use strict";i.a(e,async(e,o)=>{try{i.r(t),i.d(t,{default:()=>w});var s=i(20997),n=i(35402),r=i.n(n);i(30108);var a=i(41649),l=i(40968),c=i.n(l),d=i(77646),u=i(16689),g=i(46812),m=i(83143),h=i(70749),f=i(59165),p=i(79231),v=i(30072),y=i(86201),x=e([d,g,f,v,y]);function b({error:e,resetErrorBoundary:t}){return s.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:(0,s.jsxs)("div",{className:"p-6 max-w-sm w-full bg-white shadow-lg rounded-lg",children:[s.jsx("h2",{className:"text-xl font-bold text-red-600 mb-4",children:"Something went wrong"}),s.jsx("p",{className:"text-gray-700 mb-4",children:e.message}),s.jsx("button",{onClick:t,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Try again"})]})})}function w({Component:e,pageProps:{session:t,...i}}){return(0,u.useEffect)(()=>{let e=e=>{console.error("Caught in global handler:",e.error)};return window.addEventListener("error",e),()=>window.removeEventListener("error",e)},[]),(0,u.useEffect)(()=>{console.log("[App] Session provided to SessionProvider:",t),console.log("[App] Cookies available:",document.cookie)},[t]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(c(),{children:[s.jsx("title",{children:"P-Chart System"}),s.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),s.jsx("link",{rel:"icon",href:"/jae-logo.png"})]}),s.jsx(a.SessionProvider,{session:t,...(0,m.aA)(),basePath:"/api/auth",refetchOnWindowFocus:!0,refetchInterval:300,children:s.jsx(h.f,{children:s.jsx(p.md,{children:(0,s.jsxs)(f.JB,{children:[s.jsx(g.ErrorBoundary,{FallbackComponent:b,onReset:()=>{},children:s.jsx("main",{className:r().className,children:s.jsx(e,{...i})})}),s.jsx(v.T,{}),s.jsx(d.x,{}),s.jsx(y.Toaster,{position:"top-right",toastOptions:{duration:4e3,style:{maxWidth:"350px",fontSize:"0.875rem"}},containerStyle:{top:40,right:20,maxHeight:"calc(100vh - 100px)",maxWidth:"100%",overflow:"hidden"},containerClassName:"!pointer-events-none",gutter:8})]})})})})]})}[d,g,f,v,y]=x.then?(await x)():x,o()}catch(e){o(e)}})},30108:()=>{}};