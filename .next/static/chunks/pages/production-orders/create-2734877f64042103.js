(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[196],{45977:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,t(84297).Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},45098:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/production-orders/create",function(){return t(33554)}])},45847:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});var s=t(85893),o=t(89630),n=t(5716);function a(e){let{children:r}=e;return(0,s.jsxs)("div",{className:"flex min-h-screen flex-col",children:[(0,s.jsx)(o.Z,{}),(0,s.jsx)("main",{className:"flex-1",children:(0,s.jsx)("div",{className:"container",children:r})}),(0,s.jsx)(n.Z,{})]})}},33566:function(e,r,t){"use strict";var s=t(85893);t(67294);var o=t(87764),n=t(35037);r.Z=e=>{let{title:r,description:t,searchPlaceholder:a="Search...",searchValue:i="",onSearchChange:l,actions:c}=e;return console.log("PageHeader: Rendering for ".concat(r)),(0,s.jsx)("div",{className:"w-full",children:(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold text-purple-700",children:r}),t&&(0,s.jsx)("p",{className:"text-gray-600 mt-1",children:t})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[l&&(0,s.jsxs)("div",{className:"relative w-96",children:[(0,s.jsx)(o.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-gray-500"}),(0,s.jsx)(n.I,{type:"search",placeholder:a,className:"pl-8",value:i,onChange:l})]}),c]})]})})}},17344:function(e,r,t){"use strict";t.d(r,{a:function(){return l}});var s=t(33299),o=t(11163),n=t(67294),a=t(98225),i=t(65050);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{data:r,status:t}=(0,s.useSession)(),l=(0,o.useRouter)(),{toast:c}=(0,i.pm)(),[d,u]=(0,n.useState)(!1),[m,h]=(0,n.useState)(!0),[x,p]=(0,n.useState)(null),[g,v]=(0,n.useState)(!1),{redirectTo:f="/auth/login",requiredRoles:b=[]}=e;(0,n.useEffect)(()=>{if(console.log("Auth effect running, status:",t,"verified:",g),"loading"===t||g)return;if(null==r?void 0:r.user){if(console.log("Found NextAuth session, storing to localStorage"),a.UserSession.storeSession(r.user),b.length>0){var e;let t=((null==r?void 0:null===(e=r.user)||void 0===e?void 0:e.role)||"").toLowerCase();if(!b.some(e=>e.toLowerCase()===t)){console.log("Required role not found. User role: ".concat(t)),u(!1),h(!1),p("You do not have permission to access this page"),v(!0),l.push("/dashboard");return}}u(!0),h(!1),p(null),v(!0);return}let s=a.UserSession.getSession();if(s){if(console.log("Found valid localStorage session, using as fallback"),b.length>0){let e=(s.role||"").toLowerCase();if(!b.some(r=>r.toLowerCase()===e)){console.log("Required role not found. Local user role: ".concat(e)),u(!1),h(!1),p("You do not have permission to access this page"),v(!0),l.push("/dashboard");return}}u(!0),h(!1),p(null),v(!0);return}console.log("No valid session found, redirecting to login"),l.push("".concat(f,"?callbackUrl=").concat(encodeURIComponent(window.location.href)))},[t,r,l,f,b,g]);let N=(0,n.useCallback)(()=>a.UserSession.getAuthHeaders(),[]),j=(0,n.useCallback)(async()=>a.UserSession.getCurrentUser(),[]),y=(0,n.useCallback)(e=>a.UserSession.hasRole(e),[]),w=(0,n.useCallback)(()=>{console.log("Handling expired session"),a.UserSession.clearSession(),(0,s.signOut)({redirect:!1});let e=window.location.href;l.push("".concat(f,"?callbackUrl=").concat(encodeURIComponent(e),"&expired=true"))},[f,l]),k=(0,n.useCallback)(e=>{switch(e.status){case 401:return console.log("Detected 401 unauthorized response - session likely expired"),w(),!1;case 403:return console.log("Detected 403 forbidden response - permission denied"),c({title:"Permission Denied",description:"You don't have permission to access this resource",variant:"destructive"}),!1;case 429:return console.log("Detected 429 response - rate limited"),c({title:"Rate Limited",description:"Too many requests. Please try again later.",variant:"destructive"}),!1;case 500:case 502:case 503:case 504:return console.log("Detected server error (".concat(e.status,")")),c({title:"Server Error",description:"The server encountered an error. Please try again later.",variant:"destructive"}),!1}return!0},[w,c]);return{session:r,status:t,isAuthorized:d,isLoading:m,authError:x,getAuthHeaders:N,getCurrentUser:j,hasRole:y,handleExpiredSession:w,checkResponseAuth:k}}},33554:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return y}});var s=t(85893),o=t(67294),n=t(11163),a=t(9008),i=t.n(a),l=t(87249),c=t(35037),d=t(65050),u=t(45847),m=t(17344),h=t(12003),x=t(44531);let p=(0,h.j)("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",info:"border-info/50 text-info dark:border-info [&>svg]:text-info",warning:"border-warning/50 text-warning dark:border-warning [&>svg]:text-warning",success:"border-success/50 text-success dark:border-success [&>svg]:text-success"}},defaultVariants:{variant:"default"}}),g=o.forwardRef((e,r)=>{let{className:t,variant:o,...n}=e;return(0,s.jsx)("div",{ref:r,role:"alert",className:(0,x.cn)(p({variant:o}),t),...n})});g.displayName="Alert";let v=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,s.jsx)("h5",{ref:r,className:(0,x.cn)("mb-1 font-medium leading-none tracking-tight",t),...o})});v.displayName="AlertTitle";let f=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,s.jsx)("div",{ref:r,className:(0,x.cn)("text-sm [&_p]:leading-relaxed",t),...o})});f.displayName="AlertDescription";var b=t(33299),N=t(33566),j=t(45977);function y(){var e,r,t,a,h,x;let{toast:p}=(0,d.pm)(),y=(0,n.useRouter)(),{isAuthorized:w,isLoading:k,getAuthHeaders:C}=(0,m.a)(),{initialPoNumber:S}=y.query,{data:E}=(0,b.useSession)(),[P,q]=(0,o.useState)(!1),[D,L]=(0,o.useState)(!0),[O,R]=(0,o.useState)(null),[U,_]=(0,o.useState)({poNumber:"string"==typeof S?S:"",lotNumber:"",quantity:"",itemName:""});(0,o.useEffect)(()=>{(async()=>{try{console.log("Checking if database is properly seeded");let e=await fetch("/api/operation-steps",{headers:C()});if(!e.ok)throw Error("Failed to fetch operation steps");let r=await e.json();if(!r||0===r.length){R("No operation steps found in database. Please run database seeding.");return}console.log("Found ".concat(r.length," operation steps")),R(null)}catch(r){console.error("Error checking database:",r);let e=r instanceof Error?r.message:"An unknown error occurred";R("Database setup issue: ".concat(e))}finally{L(!1)}})()},[C]);let Z=e=>{let{name:r,value:t}=e.target;_({...U,[r]:t})},A=e=>{if("Enter"===e.key){var r;e.preventDefault(),console.log("Enter key detected, preventing automatic submission");let t=null===(r=e.currentTarget.form)||void 0===r?void 0:r.querySelector('input[name="'.concat(I(e.currentTarget.name),'"]'));t&&t.focus()}},I=e=>{let r=["poNumber","lotNumber","quantity","itemName"],t=r.indexOf(e);return t<r.length-1?r[t+1]:"poNumber"},T=async e=>{if(e.preventDefault(),!U.poNumber){p({title:"Error",description:"Production Order Number is required",variant:"destructive"});return}if(!U.quantity){p({title:"Error",description:"Quantity is required",variant:"destructive"});return}q(!0);try{console.log("Submitting production order:",U);let e=await fetch("/api/production-orders/create",{method:"POST",headers:{...C(),"Content-Type":"application/json"},body:JSON.stringify({poNumber:U.poNumber,lotNumber:U.lotNumber,poQuantity:U.quantity,itemName:U.itemName})});if(console.log("Response status:",e.status),!e.ok){let r=await e.json();throw console.error("API error:",r),Error(r.error||"Failed to create production order")}let r=await e.json();console.log("Created production order:",r),p({title:"Success",description:"Production order created successfully!"}),y.push({pathname:"/production-orders/".concat(U.poNumber),query:{newOrder:"true"}})}catch(e){console.error("Error creating production order:",e),p({title:"Error",description:e instanceof Error?e.message:"An unknown error occurred",variant:"destructive"})}finally{q(!1)}};return k||D?(0,s.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i(),{children:(0,s.jsx)("title",{children:"Create Production Order - P-Chart System"})}),(null==E?void 0:null===(r=E.user)||void 0===r?void 0:null===(e=r.role)||void 0===e?void 0:e.toLowerCase())!=="viewer"&&(0,s.jsx)(u.Z,{children:(0,s.jsxs)("div",{className:"mx-auto py-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold text-purple-700",children:"Create New Production Order"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(null==E?void 0:null===(a=E.user)||void 0===a?void 0:null===(t=a.role)||void 0===t?void 0:t.toLowerCase())==="viewer"&&(0,s.jsx)("div",{className:"text-xs px-2 py-1 bg-purple-100 text-purple-800 rounded-md",children:"Viewer Mode"}),(0,s.jsx)(l.z,{variant:"outline",onClick:()=>y.push("/production-orders"),children:"Back to List"})]})]}),O&&(0,s.jsxs)(g,{variant:"destructive",className:"mb-6",children:[(0,s.jsx)(v,{children:"Database Error"}),(0,s.jsx)(f,{children:O})]}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,s.jsxs)("form",{onSubmit:T,children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"PO Number*"}),(0,s.jsx)(c.I,{name:"poNumber",value:U.poNumber,onChange:Z,onKeyDown:A,required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Lot Number"}),(0,s.jsx)(c.I,{name:"lotNumber",value:U.lotNumber,onChange:Z,onKeyDown:A})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Quantity*"}),(0,s.jsx)(c.I,{name:"quantity",type:"number",min:"1",value:U.quantity,onChange:Z,onKeyDown:A,required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Item Name"}),(0,s.jsx)(c.I,{name:"itemName",value:U.itemName,onChange:Z,onKeyDown:A})]})]}),(0,s.jsx)("div",{className:"mt-6 text-right",children:(0,s.jsx)(l.z,{type:"submit",className:"bg-purple-600 hover:bg-purple-700 text-white",disabled:P||!w,children:P?"Creating...":"Create Production Order"})})]})}),(0,s.jsxs)("div",{className:"mt-6 bg-gray-50 p-4 rounded-lg hidden",children:[(0,s.jsx)("h2",{className:"text-lg font-medium mb-2",children:"Debug Information"}),(0,s.jsx)("p",{className:"text-xs text-gray-600",children:"For troubleshooting purposes only"}),(0,s.jsx)("pre",{className:"mt-2 text-xs bg-gray-100 p-2 rounded overflow-auto max-h-60",children:JSON.stringify({formData:U,isSubmitting:P,dbError:O,authStatus:w?"Authorized":"Unauthorized"},null,2)})]})]})}),(null==E?void 0:null===(x=E.user)||void 0===x?void 0:null===(h=x.role)||void 0===h?void 0:h.toLowerCase())==="viewer"&&(0,s.jsx)(u.Z,{children:(0,s.jsxs)("div",{className:"py-6",children:[(0,s.jsx)(N.Z,{title:"Create New Production Order",description:"This production order is currently locked by another user."}),(0,s.jsx)("div",{className:"bg-white dark:bg-black p-6 rounded-lg shadow mb-4",children:(0,s.jsx)("div",{className:"border-l-4 border-amber-500 p-4 bg-amber-50 dark:bg-gray-900 mb-4",children:(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("div",{className:"mr-2 text-amber-500",children:(0,s.jsx)(j.Z,{className:"h-6 w-6"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-amber-800 font-semibold",children:"Viewers are not authorized to create production orders."}),(0,s.jsx)("p",{className:"text-amber-700 mt-1",children:"Please contact your administrator to create a production order."}),(0,s.jsx)("div",{className:"mt-3 flex space-x-2",children:(0,s.jsx)(l.z,{variant:"outline",onClick:()=>y.push("/production-orders"),children:"Return to List"})})]})]})})})]})})]})}}},function(e){e.O(0,[192,664,847,164,888,774,179],function(){return e(e.s=45098)}),_N_E=e.O()}]);