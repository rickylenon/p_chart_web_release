(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[734],{62705:function(e,t,r){var a=r(55639).Symbol;e.exports=a},44239:function(e,t,r){var a=r(62705),n=r(89607),o=r(2333),s=a?a.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?n(e):o(e)}},27561:function(e,t,r){var a=r(67990),n=/^\s+/;e.exports=function(e){return e?e.slice(0,a(e)+1).replace(n,""):e}},31957:function(e,t,r){var a="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;e.exports=a},89607:function(e,t,r){var a=r(62705),n=Object.prototype,o=n.hasOwnProperty,s=n.toString,c=a?a.toStringTag:void 0;e.exports=function(e){var t=o.call(e,c),r=e[c];try{e[c]=void 0;var a=!0}catch(e){}var n=s.call(e);return a&&(t?e[c]=r:delete e[c]),n}},2333:function(e){var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},55639:function(e,t,r){var a=r(31957),n="object"==typeof self&&self&&self.Object===Object&&self,o=a||n||Function("return this")();e.exports=o},67990:function(e){var t=/\s/;e.exports=function(e){for(var r=e.length;r--&&t.test(e.charAt(r)););return r}},23279:function(e,t,r){var a=r(13218),n=r(7771),o=r(14841),s=Math.max,c=Math.min;e.exports=function(e,t,r){var i,l,d,u,p,h,m=0,f=!1,x=!1,v=!0;if("function"!=typeof e)throw TypeError("Expected a function");function g(t){var r=i,a=l;return i=l=void 0,m=t,u=e.apply(a,r)}function y(e){var r=e-h,a=e-m;return void 0===h||r>=t||r<0||x&&a>=d}function b(){var e,r,a,o=n();if(y(o))return w(o);p=setTimeout(b,(e=o-h,r=o-m,a=t-e,x?c(a,d-r):a))}function w(e){return(p=void 0,v&&i)?g(e):(i=l=void 0,u)}function j(){var e,r=n(),a=y(r);if(i=arguments,l=this,h=r,a){if(void 0===p)return m=e=h,p=setTimeout(b,t),f?g(e):u;if(x)return clearTimeout(p),p=setTimeout(b,t),g(h)}return void 0===p&&(p=setTimeout(b,t)),u}return t=o(t)||0,a(r)&&(f=!!r.leading,d=(x="maxWait"in r)?s(o(r.maxWait)||0,t):d,v="trailing"in r?!!r.trailing:v),j.cancel=function(){void 0!==p&&clearTimeout(p),m=0,i=h=l=p=void 0},j.flush=function(){return void 0===p?u:w(n())},j}},13218:function(e){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},37005:function(e){e.exports=function(e){return null!=e&&"object"==typeof e}},33448:function(e,t,r){var a=r(44239),n=r(37005);e.exports=function(e){return"symbol"==typeof e||n(e)&&"[object Symbol]"==a(e)}},7771:function(e,t,r){var a=r(55639);e.exports=function(){return a.Date.now()}},14841:function(e,t,r){var a=r(27561),n=r(13218),o=r(33448),s=0/0,c=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,l=/^0o[0-7]+$/i,d=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return s;if(n(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=n(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=a(e);var r=i.test(e);return r||l.test(e)?d(e.slice(2),r?2:8):c.test(e)?s:+e}},61932:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(84297).Z)("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]])},13756:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(84297).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},13025:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(84297).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},94424:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(84297).Z)("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]])},37087:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(84297).Z)("FileUp",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]])},90470:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(84297).Z)("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]])},28142:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(84297).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},42027:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(84297).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},98842:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/standard-costs",function(){return r(91408)}])},91408:function(e,t,r){"use strict";r.r(t);var a=r(85893),n=r(33299),o=r(11163),s=r(67294),c=r(45847),i=r(9008),l=r.n(i),d=r(23279),u=r.n(d),p=r(33566),h=r(87249),m=r(98225),f=r(25998),x=r(90470),v=r(42027),g=r(13756),y=r(13025),b=r(28142),w=r(37087),j=r(94424),k=r(86501),C=r(87776);t.default=(0,m.c2)(function(){let{data:e,status:t}=(0,n.useSession)(),r=(0,o.useRouter)(),[i,d]=(0,s.useState)([]),[m,S]=(0,s.useState)(!0),[N,E]=(0,s.useState)(null),[F,A]=(0,s.useState)(1),[Z,U]=(0,s.useState)(10),[P,O]=(0,s.useState)(0),[T,M]=(0,s.useState)(1),[R,_]=(0,s.useState)(""),[L,z]=(0,s.useState)(""),[D,V]=(0,s.useState)(""),[I,q]=(0,s.useState)("itemName"),[X,H]=(0,s.useState)("asc"),[$,W]=(0,s.useState)(!1),[B,G]=(0,s.useState)(!1),J=(0,s.useRef)(null),K=(0,s.useCallback)(async()=>{try{S(!0);let e=new URLSearchParams;e.append("page",F.toString()),e.append("limit",Z.toString()),L&&e.append("search",L),D&&e.append("active",D),I&&e.append("sortField",I),X&&e.append("sortDirection",X),console.log("Fetching standard costs with params:",Object.fromEntries(e.entries()));let t=await fetch("/api/standard-costs?".concat(e.toString()));if(!t.ok)throw Error("Failed to fetch standard costs");let r=await t.json();console.log("Fetched standard costs data:",r),d(r.data),O(r.total),M(r.totalPages)}catch(e){console.error("Error fetching standard costs:",e),E("Failed to load standard costs. Please try again later.")}finally{S(!1)}},[F,Z,L,D,I,X]);(0,s.useEffect)(()=>{"authenticated"===t&&K()},[t,K]);let Q=(0,s.useCallback)(e=>{console.log("Debounced search with value:",e),z(e),A(1)},[z,A]),Y=(e,t)=>{"status"===e&&V(t),A(1)},ee=e=>{r.push("/standard-costs/edit/".concat(e))},et=async(e,t)=>{try{let r=t?"deactivate":"activate";console.log("Toggling standard cost ".concat(e," status to ").concat(t?"inactive":"active"));let a=await fetch("/api/standard-costs/".concat(e,"/").concat(r),{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include"});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to ".concat(r," standard cost"))}k.Am.success("Standard cost ".concat(r,"d successfully")),K()}catch(e){console.error("Error ".concat(t?"deactivating":"activating"," standard cost:"),e),k.Am.error(e instanceof Error?e.message:"Failed to ".concat(t?"deactivate":"activate"," standard cost"))}},er=async()=>{try{var e,t;let r=await fetch("/api/standard-costs/export",{credentials:"include"});if(!r.ok)throw Error("Failed to export standard costs");let a=await r.blob(),n=window.URL.createObjectURL(a),o=document.createElement("a");o.href=n,o.download=(null===(t=r.headers.get("Content-Disposition"))||void 0===t?void 0:null===(e=t.split("filename=")[1])||void 0===e?void 0:e.replace(/"/g,""))||"standard_costs.xlsx",document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(n),k.Am.success("Standard costs exported successfully")}catch(e){console.error("Error exporting standard costs:",e),k.Am.error("Failed to export standard costs")}},ea=async()=>{try{let e=await fetch("/api/standard-costs/template",{credentials:"include"});if(!e.ok)throw Error("Failed to download template");let t=await e.blob(),r=window.URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download="standard_costs_template.xlsx",document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(r),k.Am.success("Excel template downloaded successfully")}catch(e){console.error("Error downloading template:",e),k.Am.error("Failed to download template")}},en=async()=>{try{let e=await fetch("/api/standard-costs/template.csv",{credentials:"include"});if(!e.ok)throw Error("Failed to download CSV template");let t=await e.blob(),r=window.URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download="standard_costs_template.csv",document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(r),k.Am.success("CSV template downloaded successfully")}catch(e){console.error("Error downloading CSV template:",e),k.Am.error("Failed to download CSV template")}},eo=async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){if(B&&!window.confirm("⚠️ Replace All Mode\n\nThis will DELETE all existing standard costs and replace them with the imported data.\n\nThis action cannot be undone. Are you sure you want to continue?")){J.current&&(J.current.value="");return}try{W(!0);let e=new FormData;e.append("file",r),e.append("replaceAll",B.toString());let t=await fetch("/api/standard-costs/import",{method:"POST",body:e,credentials:"include"}),a=await t.json();if(!t.ok)throw Error(a.error||"Failed to import file");let n=B?"Replace completed: ".concat(a.deletedCount," deleted, ").concat(a.successCount," created, ").concat(a.errorCount," errors"):"Import completed: ".concat(a.successCount," imported, ").concat(a.errorCount," errors");if(a.productionOrdersUpdated>0&&(n+=". Updated ".concat(a.productionOrdersUpdated," production orders.")),k.Am.success(n),a.errors&&a.errors.length>0&&(console.log("Import errors:",a.errors),a.errorCount>0)){let e=a.errors.slice(0,3).join("\n");k.Am.error("Some records failed:\n".concat(e).concat(a.errorCount>3?"\n...and more":""))}K()}catch(e){console.error("Error importing file:",e),k.Am.error(e instanceof Error?e.message:"Failed to import file")}finally{W(!1),G(!1),J.current&&(J.current.value="")}}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l(),{children:(0,a.jsx)("title",{children:"Standard Costs Management - P-Chart System"})}),(0,a.jsx)(c.Z,{children:(0,a.jsxs)("div",{className:"py-6",children:[(0,a.jsx)(p.Z,{title:"Standard Costs Management",description:"Add and manage standard costs for defect cost calculations",searchPlaceholder:"Search by item name, description, etc.",searchValue:R,onSearchChange:e=>{let t=e.target.value;console.log("Search input changed:",t),_(t),u()(()=>Q(t),500)()},actions:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(h.z,{onClick:er,variant:"outline",className:"bg-green-50 text-green-700 border-green-200 hover:bg-green-100",children:[(0,a.jsx)(y.Z,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,a.jsxs)(C.h_,{children:[(0,a.jsx)(C.$F,{asChild:!0,children:(0,a.jsxs)(h.z,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200 hover:bg-blue-100",disabled:$,children:[(0,a.jsx)(b.Z,{className:"h-4 w-4 mr-2"}),$?"Importing...":"Import"]})}),(0,a.jsxs)(C.AW,{align:"end",className:"min-w-[250px]",children:[(0,a.jsxs)("div",{className:"p-3 border-b",children:[(0,a.jsxs)("label",{className:"flex items-center space-x-2 text-sm",children:[(0,a.jsx)("input",{type:"checkbox",checked:B,onChange:e=>G(e.target.checked),className:"rounded border-gray-300"}),(0,a.jsx)("span",{className:"text-gray-700",children:"Replace all existing records"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:B?"⚠️ This will delete all existing standard costs":"Update existing records or add new ones"})]}),(0,a.jsxs)(C.Xi,{onClick:()=>{var e;null===(e=J.current)||void 0===e||e.click()},children:[(0,a.jsx)(w.Z,{className:"h-4 w-4 mr-2"}),"Upload Excel/CSV File"]}),(0,a.jsxs)(C.Xi,{onClick:ea,children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"Download Excel Template"]}),(0,a.jsxs)(C.Xi,{onClick:en,children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"Download CSV Template"]})]})]}),(0,a.jsx)("input",{type:"file",ref:J,accept:".xlsx,.xls,.csv",className:"hidden",onChange:eo,"aria-label":"Import Excel or CSV file"}),(0,a.jsx)(h.z,{onClick:()=>{r.push("/standard-costs/add")},className:"bg-purple-600 hover:bg-purple-700 text-white",children:"Add New Standard Cost"})]})}),(0,a.jsx)("div",{className:"mb-6 p-4 bg-white dark:bg-gray-800 shadow rounded-lg",children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"statusFilter",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Status"}),(0,a.jsxs)("select",{id:"statusFilter",value:D,onChange:e=>Y("status",e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm","aria-label":"Filter by status",children:[(0,a.jsx)("option",{value:"",children:"All Statuses"}),(0,a.jsx)("option",{value:"true",children:"Active"}),(0,a.jsx)("option",{value:"false",children:"Inactive"})]})]})})}),(0,a.jsx)(f.w,{data:i,columns:[{key:"itemName",header:"Item Name",sortable:!0,render:e=>(0,a.jsx)("div",{className:"font-medium",children:e.itemName})},{key:"costPerUnit",header:"Cost Per Unit",sortable:!0,render:e=>{let t="number"==typeof e.costPerUnit?e.costPerUnit:parseFloat(String(e.costPerUnit));return(0,a.jsxs)("div",{className:"font-mono",children:[e.currency," ",isNaN(t)?"0.0000":t.toFixed(4)]})}},{key:"currency",header:"Currency",sortable:!0,render:e=>(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded-full",children:e.currency})},{key:"isActive",header:"Status",sortable:!0,render:e=>(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"Active":"Inactive"})},{key:"actions",header:"Actions",render:e=>(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(h.z,{variant:"ghost",size:"icon",onClick:()=>ee(e.id),className:"text-blue-600 hover:text-blue-900",children:(0,a.jsx)(x.Z,{className:"h-4 w-4"})}),(0,a.jsx)(h.z,{variant:"ghost",size:"icon",onClick:()=>et(e.id,e.isActive),className:e.isActive?"text-red-600 hover:text-red-900":"text-green-600 hover:text-green-900",children:e.isActive?(0,a.jsx)(v.Z,{className:"h-4 w-4"}):(0,a.jsx)(g.Z,{className:"h-4 w-4"})})]})}],keyField:"id",isLoading:m,error:N||void 0,sortField:I,sortDirection:X,onSortChange:(e,t)=>{console.log("Sorting by ".concat(e," in ").concat(t," order")),q(e),H(t)},pagination:{currentPage:F,totalPages:T,totalItems:P,itemsPerPage:Z,onPageChange:e=>A(e),onItemsPerPageChange:e=>{U(e),A(1)}},emptyMessage:"No standard costs found matching the current filters."})]})})]})})}},function(e){e.O(0,[192,664,847,164,87,888,774,179],function(){return e(e.s=98842)}),_N_E=e.O()}]);