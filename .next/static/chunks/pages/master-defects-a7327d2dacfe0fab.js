(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4562],{62705:function(e,t,r){var a=r(55639).Symbol;e.exports=a},44239:function(e,t,r){var a=r(62705),n=r(89607),o=r(2333),s=a?a.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?n(e):o(e)}},27561:function(e,t,r){var a=r(67990),n=/^\s+/;e.exports=function(e){return e?e.slice(0,a(e)+1).replace(n,""):e}},31957:function(e,t,r){var a="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;e.exports=a},89607:function(e,t,r){var a=r(62705),n=Object.prototype,o=n.hasOwnProperty,s=n.toString,i=a?a.toStringTag:void 0;e.exports=function(e){var t=o.call(e,i),r=e[i];try{e[i]=void 0;var a=!0}catch(e){}var n=s.call(e);return a&&(t?e[i]=r:delete e[i]),n}},2333:function(e){var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},55639:function(e,t,r){var a=r(31957),n="object"==typeof self&&self&&self.Object===Object&&self,o=a||n||Function("return this")();e.exports=o},67990:function(e){var t=/\s/;e.exports=function(e){for(var r=e.length;r--&&t.test(e.charAt(r)););return r}},23279:function(e,t,r){var a=r(13218),n=r(7771),o=r(14841),s=Math.max,i=Math.min;e.exports=function(e,t,r){var c,l,d,u,f,h,p=0,m=!1,g=!1,x=!0;if("function"!=typeof e)throw TypeError("Expected a function");function v(t){var r=c,a=l;return c=l=void 0,p=t,u=e.apply(a,r)}function y(e){var r=e-h,a=e-p;return void 0===h||r>=t||r<0||g&&a>=d}function b(){var e,r,a,o=n();if(y(o))return j(o);f=setTimeout(b,(e=o-h,r=o-p,a=t-e,g?i(a,d-r):a))}function j(e){return(f=void 0,x&&c)?v(e):(c=l=void 0,u)}function k(){var e,r=n(),a=y(r);if(c=arguments,l=this,h=r,a){if(void 0===f)return p=e=h,f=setTimeout(b,t),m?v(e):u;if(g)return clearTimeout(f),f=setTimeout(b,t),v(h)}return void 0===f&&(f=setTimeout(b,t)),u}return t=o(t)||0,a(r)&&(m=!!r.leading,d=(g="maxWait"in r)?s(o(r.maxWait)||0,t):d,x="trailing"in r?!!r.trailing:x),k.cancel=function(){void 0!==f&&clearTimeout(f),p=0,c=h=l=f=void 0},k.flush=function(){return void 0===f?u:j(n())},k}},13218:function(e){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},37005:function(e){e.exports=function(e){return null!=e&&"object"==typeof e}},33448:function(e,t,r){var a=r(44239),n=r(37005);e.exports=function(e){return"symbol"==typeof e||n(e)&&"[object Symbol]"==a(e)}},7771:function(e,t,r){var a=r(55639);e.exports=function(){return a.Date.now()}},14841:function(e,t,r){var a=r(27561),n=r(13218),o=r(33448),s=0/0,i=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,l=/^0o[0-7]+$/i,d=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return s;if(n(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=n(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=a(e);var r=c.test(e);return r||l.test(e)?d(e.slice(2),r?2:8):i.test(e)?s:+e}},61932:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(84297).Z)("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]])},13756:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(84297).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},13025:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(84297).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},94424:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(84297).Z)("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]])},37087:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(84297).Z)("FileUp",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]])},90470:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(84297).Z)("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]])},42027:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(84297).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},4331:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/master-defects",function(){return r(37176)}])},37176:function(e,t,r){"use strict";r.r(t);var a=r(85893),n=r(33299),o=r(11163),s=r(67294),i=r(45847),c=r(9008),l=r.n(c),d=r(23279),u=r.n(d),f=r(33566),h=r(87249),p=r(98225),m=r(25998),g=r(90470),x=r(42027),v=r(13756),y=r(13025),b=r(28142),j=r(37087),k=r(94424),w=r(86501),N=r(87776);t.default=(0,p.c2)(function(){let{data:e,status:t}=(0,n.useSession)(),r=(0,o.useRouter)(),[c,d]=(0,s.useState)([]),[p,S]=(0,s.useState)(!0),[F,E]=(0,s.useState)(null),[A,C]=(0,s.useState)(1),[Z,P]=(0,s.useState)(10),[O,M]=(0,s.useState)(0),[T,z]=(0,s.useState)(1),[D,I]=(0,s.useState)(""),[_,q]=(0,s.useState)(""),[U,V]=(0,s.useState)([]),[X,L]=(0,s.useState)([]),[R,$]=(0,s.useState)(""),[H,W]=(0,s.useState)(""),[Y,B]=(0,s.useState)(""),[G,J]=(0,s.useState)("name"),[K,Q]=(0,s.useState)("asc"),[ee,et]=(0,s.useState)(!1),er=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/master-defects/filters");if(!e.ok)throw Error("Failed to fetch filter options");let t=await e.json();console.log("Fetched filter options:",t),V(t.categories||[]),L(t.operations||[])}catch(e){console.error("Error fetching filter options:",e)}};"authenticated"===t&&e()},[t]);let ea=(0,s.useCallback)(async()=>{try{S(!0);let e=new URLSearchParams;e.append("page",A.toString()),e.append("limit",Z.toString()),R&&e.append("category",R),H&&e.append("operation",H),_&&e.append("search",_),Y&&e.append("active",Y),G&&e.append("sortField",G),K&&e.append("sortDirection",K),console.log("Fetching master defects with params:",Object.fromEntries(e.entries()));let t=await fetch("/api/master-defects?".concat(e.toString()));if(!t.ok)throw Error("Failed to fetch master defects");let r=await t.json();console.log("Fetched master defects data:",r),d(r.data),M(r.total),z(r.totalPages)}catch(e){console.error("Error fetching master defects:",e),E("Failed to load master defects. Please try again later.")}finally{S(!1)}},[A,Z,R,H,_,Y,G,K]);(0,s.useEffect)(()=>{"authenticated"===t&&ea()},[t,ea]);let en=(0,s.useCallback)(e=>{console.log("Debounced search with value:",e),q(e),C(1)},[q,C]),eo=(e,t)=>{switch(e){case"category":$(t);break;case"operation":W(t);break;case"status":B(t)}C(1)},es=e=>{r.push("/master-defects/edit/".concat(e))},ei=async(e,t)=>{try{let r=t?"deactivate":"activate";console.log("Toggling master defect ".concat(e," status to ").concat(t?"inactive":"active"));let a=await fetch("/api/master-defects/".concat(e,"/").concat(r),{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include"});if(!a.ok){let e=await a.json().catch(()=>({}));throw console.error("API error (".concat(a.status,"):"),e),Error("Failed to ".concat(r," master defect"))}d(c.map(r=>r.id===e?{...r,isActive:!t}:r)),E(null)}catch(e){console.error("Error toggling master defect status:",e),E("Failed to update master defect status. Please try again.")}},ec=async()=>{try{console.log("Initiating Excel export"),window.location.href="/api/master-defects/export",w.Am.success("Exporting master defects to Excel")}catch(e){console.error("Error exporting to Excel:",e),w.Am.error("Failed to export master defects")}},el=async e=>{try{console.log("Initiating Excel import");let t=e.target.files;if(!t||0===t.length){console.log("No file selected");return}let r=t[0];console.log("Selected file: ".concat(r.name,", size: ").concat(r.size," bytes")),et(!0);let a=new FormData;a.append("file",r);let n=await fetch("/api/master-defects/import",{method:"POST",body:a});if(!n.ok){let e=await n.json();throw Error(e.message||"Failed to import file")}let o=await n.json();console.log("Import result:",o),w.Am.success(o.message||"Import completed successfully"),ea()}catch(e){console.error("Error importing from Excel:",e),w.Am.error(e instanceof Error?e.message:"Failed to import master defects")}finally{et(!1),er.current&&(er.current.value="")}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l(),{children:(0,a.jsx)("title",{children:"Defects Management - P-Chart System"})}),(0,a.jsx)(i.Z,{children:(0,a.jsxs)("div",{className:"py-6",children:[(0,a.jsx)(f.Z,{title:"Defects Management",description:"Add and manage defect categories for quality control",searchPlaceholder:"Search by name, description, etc.",searchValue:D,onSearchChange:e=>{let t=e.target.value;console.log("Search input changed:",t),I(t),u()(()=>en(t),500)()},actions:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(h.z,{onClick:ec,variant:"outline",className:"bg-green-50 text-green-700 border-green-200 hover:bg-green-100",children:[(0,a.jsx)(y.Z,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,a.jsxs)(N.h_,{children:[(0,a.jsx)(N.$F,{asChild:!0,children:(0,a.jsxs)(h.z,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200 hover:bg-blue-100",disabled:ee,children:[(0,a.jsx)(b.Z,{className:"h-4 w-4 mr-2"}),ee?"Importing...":"Import"]})}),(0,a.jsxs)(N.AW,{align:"end",children:[(0,a.jsxs)(N.Xi,{onClick:()=>{er.current&&er.current.click()},children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"Upload Excel File"]}),(0,a.jsxs)(N.Xi,{onClick:()=>{try{console.log("Downloading import template"),window.location.href="/api/master-defects/template",w.Am.success("Downloading template file")}catch(e){console.error("Error downloading template:",e),w.Am.error("Failed to download template")}},children:[(0,a.jsx)(k.Z,{className:"h-4 w-4 mr-2"}),"Download Template"]})]})]}),(0,a.jsx)("input",{type:"file",ref:er,onChange:el,accept:".xlsx,.xls",className:"hidden","aria-label":"Import Excel file"}),(0,a.jsx)(h.z,{onClick:()=>{r.push("/master-defects/add")},className:"bg-purple-600 hover:bg-purple-700 text-white",children:"Add New Defect"})]})}),(0,a.jsx)("div",{className:"mb-6 p-4 bg-white dark:bg-gray-800 shadow rounded-lg",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"categoryFilter",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Category"}),(0,a.jsxs)("select",{id:"categoryFilter",value:R,onChange:e=>eo("category",e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm","aria-label":"Filter by category",children:[(0,a.jsx)("option",{value:"",children:"All Categories"}),U.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"operationFilter",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Operation"}),(0,a.jsxs)("select",{id:"operationFilter",value:H,onChange:e=>eo("operation",e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm","aria-label":"Filter by operation",children:[(0,a.jsx)("option",{value:"",children:"All Operations"}),X.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"statusFilter",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Status"}),(0,a.jsxs)("select",{id:"statusFilter",value:Y,onChange:e=>eo("status",e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm","aria-label":"Filter by status",children:[(0,a.jsx)("option",{value:"",children:"All Statuses"}),(0,a.jsx)("option",{value:"true",children:"Active"}),(0,a.jsx)("option",{value:"false",children:"Inactive"})]})]})]})}),(0,a.jsx)(m.w,{data:c,columns:[{key:"name",header:"Name",sortable:!0},{key:"category",header:"Category",sortable:!0,render:e=>e.category||"N/A"},{key:"applicableOperation",header:"Operation",sortable:!0,render:e=>e.applicableOperation||"N/A"},{key:"machine",header:"Machine",sortable:!0,render:e=>e.machine||"N/A"},{key:"reworkable",header:"Reworkable",sortable:!0,render:e=>e.reworkable?"Yes":"No"},{key:"isActive",header:"Status",sortable:!0,render:e=>(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"Active":"Inactive"})},{key:"actions",header:"Actions",render:e=>(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(h.z,{variant:"ghost",size:"icon",onClick:()=>es(e.id),className:"text-blue-600 hover:text-blue-900",children:(0,a.jsx)(g.Z,{className:"h-4 w-4"})}),(0,a.jsx)(h.z,{variant:"ghost",size:"icon",onClick:()=>ei(e.id,e.isActive),className:e.isActive?"text-red-600 hover:text-red-900":"text-green-600 hover:text-green-900",children:e.isActive?(0,a.jsx)(x.Z,{className:"h-4 w-4"}):(0,a.jsx)(v.Z,{className:"h-4 w-4"})})]})}],keyField:"id",isLoading:p,error:F||void 0,sortField:G,sortDirection:K,onSortChange:(e,t)=>{console.log("Sorting by ".concat(e," in ").concat(t," order")),J(e),Q(t)},pagination:{currentPage:A,totalPages:T,totalItems:O,itemsPerPage:Z,onPageChange:e=>C(e),onItemsPerPageChange:e=>{P(e),C(1)}},emptyMessage:"No defects found matching the current filters."})]})})]})})}},function(e){e.O(0,[4192,1664,4430,7164,8087,2888,9774,179],function(){return e(e.s=4331)}),_N_E=e.O()}]);