(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[45],{54315:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/defects/add",function(){return r(82400)}])},45847:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});var a=r(85893),s=r(89630),l=r(5716);function n(e){let{children:t}=e;return(0,a.jsxs)("div",{className:"flex min-h-screen flex-col",children:[(0,a.jsx)(s.Z,{}),(0,a.jsx)("main",{className:"flex-1",children:(0,a.jsx)("div",{className:"container",children:t})}),(0,a.jsx)(l.Z,{})]})}},82400:function(e,t,r){"use strict";r.r(t);var a=r(85893),s=r(33299),l=r(11163),n=r(67294),o=r(45847),i=r(9008),c=r.n(i),d=r(98225);t.default=(0,d.c2)(function(){let{data:e,status:t}=(0,s.useSession)(),r=(0,l.useRouter)(),[i,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)([]),[h,x]=(0,n.useState)([]),[f,p]=(0,n.useState)(null),[g,b]=(0,n.useState)(null),[j,y]=(0,n.useState)(""),[w,v]=(0,n.useState)(""),[N,S]=(0,n.useState)(""),[k,C]=(0,n.useState)(""),[F,E]=(0,n.useState)(""),[_,O]=(0,n.useState)(""),[q,D]=(0,n.useState)(!1);(0,n.useEffect)(()=>{var a;console.log("Session status:",t),console.log("User role:",null==e?void 0:null===(a=e.user)||void 0===a?void 0:a.role),"unauthenticated"===t&&r.push("/auth/login")},[t,r,e]),(0,n.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/operation-steps");if(!e.ok)throw Error("Failed to fetch operations");let t=await e.json();console.log("Fetched operations:",t),m(t)}catch(e){console.error("Error fetching operations:",e),p("Failed to load operations")}},r=async()=>{try{let e=await fetch("/api/defects");if(!e.ok)throw Error("Failed to fetch defects");let t=await e.json();console.log("Fetched defects for categories:",t);let r=Array.from(new Set(t.map(e=>e.category).filter(Boolean)));x(r)}catch(e){console.error("Error fetching categories:",e)}};"authenticated"===t&&(e(),r())},[t]);let A=async e=>{if(e.preventDefault(),!j.trim()){p("Defect name is required");return}if(!F){p("Applicable operation is required");return}let t="new"===N&&k.trim()?k.trim():N;if(!t){p("Category is required");return}d(!0),p(null);try{let e=await fetch("/api/defects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:j.trim(),description:w.trim()||null,category:t,applicableOperation:F,machine:_.trim()||null,reworkable:q})});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to create defect")}let a=await e.json();console.log("Created defect:",a),b("Defect created successfully!"),y(""),v(""),S(""),C(""),E(""),O(""),D(!1),setTimeout(()=>{r.push("/defects")},2e3)}catch(e){console.error("Error creating defect:",e),p(e.message||"Failed to create defect")}finally{d(!1)}};return"loading"===t?(0,a.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c(),{children:(0,a.jsx)("title",{children:"Add Defect - P-Chart System"})}),(0,a.jsx)(o.Z,{children:(0,a.jsx)("div",{className:"py-6",children:(0,a.jsx)("div",{className:"max-w-3xl mx-auto space-y-6",children:(0,a.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Add New Defect"}),(0,a.jsx)("button",{onClick:()=>r.push("/defects"),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"Back to List"})]}),f&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded",children:f}),g&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-green-100 text-green-700 rounded",children:g}),(0,a.jsxs)("form",{onSubmit:A,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Name*"}),(0,a.jsx)("input",{type:"text",id:"name",value:j,onChange:e=>y(e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,a.jsx)("textarea",{id:"description",value:w,onChange:e=>v(e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm",rows:3})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 mb-1",children:"Category*"}),(0,a.jsxs)("select",{id:"category",value:N,onChange:e=>S(e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm",required:!0,children:[(0,a.jsx)("option",{value:"",children:"Select Category"}),h.map(e=>(0,a.jsx)("option",{value:e,children:e},e)),(0,a.jsx)("option",{value:"new",children:"+ Add New Category"})]})]}),"new"===N&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"newCategory",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Category*"}),(0,a.jsx)("input",{type:"text",id:"newCategory",value:k,onChange:e=>C(e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"applicableOperation",className:"block text-sm font-medium text-gray-700 mb-1",children:"Applicable Operation*"}),(0,a.jsxs)("select",{id:"applicableOperation",value:F,onChange:e=>E(e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm",required:!0,children:[(0,a.jsx)("option",{value:"",children:"Select Operation"}),u.map(e=>(0,a.jsxs)("option",{value:e.code,children:[e.code," - ",e.name]},e.code))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"machine",className:"block text-sm font-medium text-gray-700 mb-1",children:"Machine"}),(0,a.jsx)("input",{type:"text",id:"machine",value:_,onChange:e=>O(e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",id:"reworkable",checked:q,onChange:e=>D(e.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded"}),(0,a.jsx)("label",{htmlFor:"reworkable",className:"ml-2 block text-sm text-gray-700",children:"Reworkable (can be fixed)"})]}),(0,a.jsx)("div",{className:"pt-4",children:(0,a.jsx)("button",{type:"submit",className:"w-full md:w-auto px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors disabled:bg-blue-400",disabled:i,children:i?"Saving...":"Save Defect"})})]})]})})})})]})})}},function(e){e.O(0,[192,664,847,164,888,774,179],function(){return e(e.s=54315)}),_N_E=e.O()}]);