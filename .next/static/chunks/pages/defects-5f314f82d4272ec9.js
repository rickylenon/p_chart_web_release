(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1411],{62705:function(e,t,a){var r=a(55639).Symbol;e.exports=r},44239:function(e,t,a){var r=a(62705),n=a(89607),o=a(2333),i=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":i&&i in Object(e)?n(e):o(e)}},27561:function(e,t,a){var r=a(67990),n=/^\s+/;e.exports=function(e){return e?e.slice(0,r(e)+1).replace(n,""):e}},31957:function(e,t,a){var r="object"==typeof a.g&&a.g&&a.g.Object===Object&&a.g;e.exports=r},89607:function(e,t,a){var r=a(62705),n=Object.prototype,o=n.hasOwnProperty,i=n.toString,c=r?r.toStringTag:void 0;e.exports=function(e){var t=o.call(e,c),a=e[c];try{e[c]=void 0;var r=!0}catch(e){}var n=i.call(e);return r&&(t?e[c]=a:delete e[c]),n}},2333:function(e){var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},55639:function(e,t,a){var r=a(31957),n="object"==typeof self&&self&&self.Object===Object&&self,o=r||n||Function("return this")();e.exports=o},67990:function(e){var t=/\s/;e.exports=function(e){for(var a=e.length;a--&&t.test(e.charAt(a)););return a}},23279:function(e,t,a){var r=a(13218),n=a(7771),o=a(14841),i=Math.max,c=Math.min;e.exports=function(e,t,a){var s,l,u,d,f,h,p=0,g=!1,v=!1,m=!0;if("function"!=typeof e)throw TypeError("Expected a function");function x(t){var a=s,r=l;return s=l=void 0,p=t,d=e.apply(r,a)}function y(e){var a=e-h,r=e-p;return void 0===h||a>=t||a<0||v&&r>=u}function b(){var e,a,r,o=n();if(y(o))return j(o);f=setTimeout(b,(e=o-h,a=o-p,r=t-e,v?c(r,u-a):r))}function j(e){return(f=void 0,m&&s)?x(e):(s=l=void 0,d)}function w(){var e,a=n(),r=y(a);if(s=arguments,l=this,h=a,r){if(void 0===f)return p=e=h,f=setTimeout(b,t),g?x(e):d;if(v)return clearTimeout(f),f=setTimeout(b,t),x(h)}return void 0===f&&(f=setTimeout(b,t)),d}return t=o(t)||0,r(a)&&(g=!!a.leading,u=(v="maxWait"in a)?i(o(a.maxWait)||0,t):u,m="trailing"in a?!!a.trailing:m),w.cancel=function(){void 0!==f&&clearTimeout(f),p=0,s=h=l=f=void 0},w.flush=function(){return void 0===f?d:j(n())},w}},13218:function(e){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},37005:function(e){e.exports=function(e){return null!=e&&"object"==typeof e}},33448:function(e,t,a){var r=a(44239),n=a(37005);e.exports=function(e){return"symbol"==typeof e||n(e)&&"[object Symbol]"==r(e)}},7771:function(e,t,a){var r=a(55639);e.exports=function(){return r.Date.now()}},14841:function(e,t,a){var r=a(27561),n=a(13218),o=a(33448),i=0/0,c=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,l=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return i;if(n(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=n(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=r(e);var a=s.test(e);return a||l.test(e)?u(e.slice(2),a?2:8):c.test(e)?i:+e}},61932:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(84297).Z)("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]])},13756:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(84297).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},90470:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(84297).Z)("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]])},42027:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(84297).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},85619:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/defects",function(){return a(42373)}])},42373:function(e,t,a){"use strict";a.r(t);var r=a(85893),n=a(33299),o=a(11163),i=a(67294),c=a(45847),s=a(9008),l=a.n(s),u=a(23279),d=a.n(u),f=a(33566),h=a(87249),p=a(98225),g=a(25998),v=a(90470),m=a(42027),x=a(13756);t.default=(0,p.c2)(function(){let{data:e,status:t}=(0,n.useSession)(),a=(0,o.useRouter)(),[s,u]=(0,i.useState)([]),[p,y]=(0,i.useState)(!0),[b,j]=(0,i.useState)(null),[w,k]=(0,i.useState)(1),[S,N]=(0,i.useState)(10),[F,C]=(0,i.useState)(0),[A,P]=(0,i.useState)(1),[O,E]=(0,i.useState)(""),[T,Z]=(0,i.useState)(""),[_,M]=(0,i.useState)([]),[z,D]=(0,i.useState)([]),[I,q]=(0,i.useState)(""),[L,U]=(0,i.useState)(""),[R,V]=(0,i.useState)(""),[X,$]=(0,i.useState)("name"),[W,Y]=(0,i.useState)("asc");(0,i.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/defects/filters");if(!e.ok)throw Error("Failed to fetch filter options");let t=await e.json();console.log("Fetched filter options:",t),M(t.categories||[]),D(t.operations||[])}catch(e){console.error("Error fetching filter options:",e)}};"authenticated"===t&&e()},[t]);let B=(0,i.useCallback)(async()=>{try{y(!0);let e=new URLSearchParams;e.append("page",w.toString()),e.append("limit",S.toString()),I&&e.append("category",I),L&&e.append("operation",L),T&&e.append("search",T),R&&e.append("active",R),X&&e.append("sortField",X),W&&e.append("sortDirection",W),console.log("Fetching defects with params:",Object.fromEntries(e.entries()));let t=await fetch("/api/defects?".concat(e.toString()));if(!t.ok)throw Error("Failed to fetch defects");let a=await t.json();console.log("Fetched defects data:",a),u(a.data),C(a.total),P(a.totalPages)}catch(e){console.error("Error fetching defects:",e),j("Failed to load defects. Please try again later.")}finally{y(!1)}},[w,S,I,L,T,R,X,W]);(0,i.useEffect)(()=>{"authenticated"===t&&B()},[t,B]);let G=(0,i.useCallback)(e=>{console.log("Debounced search with value:",e),Z(e),k(1)},[Z,k]),H=(e,t)=>{switch(e){case"category":q(t);break;case"operation":U(t);break;case"status":V(t)}k(1)},J=e=>{a.push("/defects/edit/".concat(e))},K=async(e,t)=>{try{let a=t?"deactivate":"activate";console.log("Toggling defect ".concat(e," status to ").concat(t?"inactive":"active"));let r=await fetch("/api/defects/".concat(e,"/").concat(a),{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include"});if(!r.ok){let e=await r.json().catch(()=>({}));throw console.error("API error (".concat(r.status,"):"),e),Error("Failed to ".concat(a," defect"))}u(s.map(a=>a.id===e?{...a,isActive:!t}:a)),j(null)}catch(e){console.error("Error toggling defect status:",e),j("Failed to update defect status. Please try again.")}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l(),{children:(0,r.jsx)("title",{children:"Defects Management - P-Chart System"})}),(0,r.jsx)(c.Z,{children:(0,r.jsxs)("div",{className:"py-6",children:[(0,r.jsx)(f.Z,{title:"Defects Management",description:"Add and manage defect categories for quality control",searchPlaceholder:"Search by name, description, etc.",searchValue:O,onSearchChange:e=>{let t=e.target.value;console.log("Search input changed:",t),E(t),d()(()=>G(t),500)()},actions:(0,r.jsx)(h.z,{onClick:()=>{a.push("/defects/add")},className:"bg-purple-600 hover:bg-purple-700 text-white",children:"Add New Defect"})}),(0,r.jsx)("div",{className:"mb-6 p-4 bg-white shadow rounded-lg",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"categoryFilter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),(0,r.jsxs)("select",{id:"categoryFilter",value:I,onChange:e=>H("category",e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm","aria-label":"Filter by category",children:[(0,r.jsx)("option",{value:"",children:"All Categories"}),_.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"operationFilter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Operation"}),(0,r.jsxs)("select",{id:"operationFilter",value:L,onChange:e=>H("operation",e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm","aria-label":"Filter by operation",children:[(0,r.jsx)("option",{value:"",children:"All Operations"}),z.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"statusFilter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),(0,r.jsxs)("select",{id:"statusFilter",value:R,onChange:e=>H("status",e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm","aria-label":"Filter by status",children:[(0,r.jsx)("option",{value:"",children:"All Statuses"}),(0,r.jsx)("option",{value:"true",children:"Active"}),(0,r.jsx)("option",{value:"false",children:"Inactive"})]})]})]})}),(0,r.jsx)(g.w,{data:s,columns:[{key:"name",header:"Name",sortable:!0},{key:"category",header:"Category",sortable:!0,render:e=>e.category||"N/A"},{key:"applicableOperation",header:"Operation",sortable:!0,render:e=>e.applicableOperation||"N/A"},{key:"machine",header:"Machine",sortable:!0,render:e=>e.machine||"N/A"},{key:"reworkable",header:"Reworkable",sortable:!0,render:e=>e.reworkable?"Yes":"No"},{key:"isActive",header:"Status",sortable:!0,render:e=>(0,r.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"Active":"Inactive"})},{key:"actions",header:"Actions",render:e=>(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,r.jsx)(h.z,{variant:"ghost",size:"icon",onClick:()=>J(e.id),className:"text-blue-600 hover:text-blue-900",children:(0,r.jsx)(v.Z,{className:"h-4 w-4"})}),(0,r.jsx)(h.z,{variant:"ghost",size:"icon",onClick:()=>K(e.id,e.isActive),className:e.isActive?"text-red-600 hover:text-red-900":"text-green-600 hover:text-green-900",children:e.isActive?(0,r.jsx)(m.Z,{className:"h-4 w-4"}):(0,r.jsx)(x.Z,{className:"h-4 w-4"})})]})}],keyField:"id",isLoading:p,error:b||void 0,sortField:X,sortDirection:W,onSortChange:(e,t)=>{console.log("Sorting by ".concat(e," in ").concat(t," order")),$(e),Y(t)},pagination:{currentPage:w,totalPages:A,totalItems:F,itemsPerPage:S,onPageChange:e=>k(e),onItemsPerPageChange:e=>{N(e),k(1)}},emptyMessage:"No defects found matching the current filters."})]})})]})})}},function(e){e.O(0,[4192,1664,4430,7164,8087,2888,9774,179],function(){return e(e.s=85619)}),_N_E=e.O()}]);