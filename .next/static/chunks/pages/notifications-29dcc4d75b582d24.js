(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[769],{61932:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(84297).Z)("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]])},18814:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(84297).Z)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]])},23217:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(84297).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},72038:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/notifications",function(){return n(44852)}])},49827:function(e,t,n){"use strict";n.d(t,{C:function(){return o}});var r=n(85893);n(67294);var a=n(12003),s=n(44531);let i=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:n,...a}=e;return(0,r.jsx)("div",{className:(0,s.cn)(i({variant:n}),t),...a})}},13749:function(e,t,n){"use strict";n.d(t,{Ol:function(){return o},SZ:function(){return d},Zb:function(){return i},aY:function(){return l},eW:function(){return u},ll:function(){return c}});var r=n(85893),a=n(67294),s=n(44531);let i=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("rounded-xl border dark:border-gray-700 bg-card text-card-foreground shadow",n),...a})});i.displayName="Card";let o=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",n),...a})});o.displayName="CardHeader";let c=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("font-semibold leading-none tracking-tight",n),...a})});c.displayName="CardTitle";let d=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",n),...a})});d.displayName="CardDescription";let l=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",n),...a})});l.displayName="CardContent";let u=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",n),...a})});u.displayName="CardFooter"},2297:function(e,t,n){"use strict";n.d(t,{_:function(){return d}});var r=n(85893),a=n(67294),s=n(49102),i=n(12003),o=n(44531);let c=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(s.f,{ref:t,className:(0,o.cn)(c(),n),...a})});d.displayName=s.f.displayName},18732:function(e,t,n){"use strict";n.d(t,{$:function(){return i}});var r=n(85893),a=n(23217),s=n(44531);function i(e){let{size:t="md",className:n}=e;return(0,r.jsx)(a.Z,{className:(0,s.cn)("animate-spin text-primary",{sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8"}[t],n)})}},44852:function(e,t,n){"use strict";n.r(t);var r=n(85893),a=n(67294),s=n(9008),i=n.n(s),o=n(11163),c=n(98225),d=n(23560),l=n(1280),u=n(45847),m=n(33566),f=n(50868),y=n(18814),h=n(76789),g=n(64998),p=n(87249),x=n(13749),N=n(37622),v=n(49827),j=n(18732),M=n(2297),w=n(25998),D=n(3332);t.default=(0,c.QO)(()=>{let e=(0,o.useRouter)(),[t,n]=(0,a.useState)(!0),[s,c]=(0,a.useState)(""),[T,C]=(0,a.useState)(1),[b,k]=(0,a.useState)(10),[S,Z]=(0,a.useState)(null),[A,H]=(0,a.useState)(!1),[_,F]=(0,a.useState)(!1),[P,R]=(0,a.useState)(null),[z,E]=(0,a.useState)(!1),{notifications:L,unreadCount:U,fetchNotifications:O,markAsRead:Y,emit:I,isConnected:V}=(0,D.lm)(),[W,q]=(0,a.useState)("createdAt"),[J,G]=(0,a.useState)("desc");(0,a.useEffect)(()=>{(async()=>{try{console.log("Fetching current user info");let e=await d.Z.get("/api/me");if(e.data){let t=e.data;Z(t);let n=t.role.toLowerCase();H("admin"===n),F("encoder"===n),console.log("Current user:",t,"isAdmin:","admin"===n,"isEncoder:","encoder"===n)}}catch(e){console.error("Error fetching current user:",e)}finally{n(!1)}})()},[]),(0,a.useEffect)(()=>{console.log("Notifications page: Calling fetchNotifications()"),O(),n(!1)},[O]),(0,a.useEffect)(()=>{console.log("Current notifications array length:",L.length),console.log("Current notifications array:",L),console.log("Unread count:",U)},[L,U]);let $=e=>{R(e),E(!0),e.isRead||Y(e.id)},X=L.filter(e=>e.title.toLowerCase().includes(s.toLowerCase())||e.message.toLowerCase().includes(s.toLowerCase())||e.type.toLowerCase().includes(s.toLowerCase()));X.slice((T-1)*b,T*b);let B=Math.ceil(X.length/b);return(0,r.jsxs)(u.Z,{children:[(0,r.jsx)(i(),{children:(0,r.jsx)("title",{children:"Notifications | P-Chart"})}),(0,r.jsxs)("div",{className:"py-6",children:[(0,r.jsx)(m.Z,{title:"Notifications",description:"View and manage your notifications in one place",searchPlaceholder:"Search notifications...",searchValue:s,onSearchChange:e=>{c(e.target.value)},actions:(A||_)&&(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsxs)(p.z,{variant:"default",onClick:()=>{e.push("/operation-defects-edit-requests")},className:"flex items-center gap-1.5",children:[(0,r.jsx)(f.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:"Operation Defects Edit Requests"}),(0,r.jsx)(y.Z,{className:"h-3.5 w-3.5 ml-1"})]})})}),(0,r.jsx)(x.Zb,{className:"mt-6",children:(0,r.jsx)(x.aY,{className:"pt-6",children:t?(0,r.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,r.jsx)(j.$,{size:"lg"})}):(0,r.jsxs)("div",{className:"space-y-4",children:[0===X.length?(0,r.jsxs)("div",{className:"py-8 text-center text-muted-foreground",children:[(0,r.jsx)(h.Z,{className:"h-12 w-12 mx-auto mb-4 opacity-30"}),(0,r.jsx)("p",{children:"You don't have any notifications at this time."})]}):(0,r.jsx)(w.w,{data:X,columns:[{key:"status",header:"",render:e=>(0,r.jsx)("div",{className:"flex items-center justify-center w-10",children:!e.isRead&&(0,r.jsx)("div",{className:"h-2 w-2 rounded-full bg-primary",title:"Unread notification"})})},{key:"title",header:"Title",sortable:!0,render:e=>(0,r.jsx)("div",{className:"font-medium ".concat(e.isRead?"":"text-primary"," cursor-pointer hover:underline"),onClick:()=>$(e),children:e.title})},{key:"message",header:"Message",render:e=>(0,r.jsx)("div",{className:"max-w-md truncate cursor-pointer hover:text-primary",title:e.message,onClick:()=>$(e),children:e.message})},{key:"type",header:"Type",sortable:!0,render:e=>(0,r.jsx)(v.C,{variant:"outline",className:"text-xs",children:e.type})},{key:"createdAt",header:"Date",sortable:!0,render:e=>(0,r.jsx)("span",{className:"text-muted-foreground text-sm",children:(0,l.ZP)(new Date(e.createdAt),"mmm d, yyyy h:MM TT")})},{key:"actions",header:"Actions",render:e=>(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[!e.isRead&&(0,r.jsx)(p.z,{size:"sm",variant:"ghost",onClick:()=>Y(e.id),children:"Mark as read"}),(0,r.jsx)(p.z,{size:"sm",variant:"outline",onClick:()=>$(e),children:"View"})]})}],keyField:"id",isLoading:t,error:"",sortField:W,sortDirection:J,onSortChange:(e,t)=>{console.log("Sorting by ".concat(e," ").concat(t)),q(e),G(t)},pagination:{currentPage:T,totalPages:B,totalItems:X.length,itemsPerPage:b,onPageChange:e=>{console.log("Changing to page ".concat(e)),C(e)},onItemsPerPageChange:e=>{console.log("Changing items per page to ".concat(e)),k(e),C(1)}},emptyMessage:"No notifications found."}),X.length>0&&(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)(p.z,{variant:"outline",size:"sm",onClick:()=>Y(void 0,void 0,!0),children:"Mark all as read"})})]})})}),(0,r.jsx)(N.Vq,{open:z,onOpenChange:E,children:(0,r.jsxs)(N.cZ,{className:"sm:max-w-md",children:[(0,r.jsxs)(N.fK,{children:[(0,r.jsx)(N.$N,{children:null==P?void 0:P.title}),(0,r.jsx)(N.Be,{children:(null==P?void 0:P.type)&&(0,r.jsx)(v.C,{variant:"outline",className:"mt-2",children:P.type})})]}),(0,r.jsxs)("div",{className:"space-y-4 py-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(M._,{className:"text-muted-foreground",children:"Date"}),(0,r.jsx)("p",{children:(null==P?void 0:P.createdAt)?(0,l.ZP)(new Date(P.createdAt),"mmmm d, yyyy h:MM:ss TT"):"N/A"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(M._,{className:"text-muted-foreground",children:"Message"}),(0,r.jsx)("p",{className:"whitespace-pre-line",children:null==P?void 0:P.message})]}),(null==P?void 0:P.sourceId)&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(M._,{className:"text-muted-foreground",children:"Reference ID"}),(0,r.jsx)("p",{children:P.sourceId})]})]}),(0,r.jsxs)(N.cN,{className:"sm:justify-between",children:[(0,r.jsx)(p.z,{variant:"ghost",onClick:()=>E(!1),children:"Close"}),(null==P?void 0:P.linkUrl)&&(0,r.jsxs)(p.z,{variant:"default",onClick:()=>{if(null==P?void 0:P.linkUrl){let t=P.linkUrl;P.sourceId&&(console.log("Adding sourceId ".concat(P.sourceId," to linkUrl ").concat(t)),t="".concat(t,"#").concat(P.sourceId)),console.log("Navigating to: ".concat(t)),e.push(t),E(!1)}},className:"flex items-center gap-1.5",children:["View Details",(0,r.jsx)(g.Z,{className:"h-4 w-4"})]})]})]})})]})]})})},49102:function(e,t,n){"use strict";n.d(t,{f:function(){return o}});var r=n(67294),a=n(75320),s=n(85893),i=r.forwardRef((e,t)=>(0,s.jsx)(a.WV.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var o=i},1280:function(e,t,n){"use strict";n.d(t,{ZP:function(){return i}});var r=/d{1,4}|D{3,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|W{1,2}|[LlopSZN]|"[^"]*"|'[^']*'/g,a=/\b(?:[A-Z]{1,3}[A-Z][TC])(?:[-+]\d{4})?|((?:Australian )?(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time)\b/g,s=/[^-+\dA-Z]/g;function i(e,t,n,a){if(1!=arguments.length||"string"!=typeof e||/\d/.test(e)||(t=e,e=void 0),(e=e||0===e?e:new Date)instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");var s=(t=String(o[t]||t||o.default)).slice(0,4);("UTC:"===s||"GMT:"===s)&&(t=t.slice(4),n=!0,"GMT:"===s&&(a=!0));var i=function(){return n?"getUTC":"get"},y=function(){return e[i()+"Date"]()},h=function(){return e[i()+"Day"]()},g=function(){return e[i()+"Month"]()},p=function(){return e[i()+"FullYear"]()},x=function(){return e[i()+"Hours"]()},N=function(){return e[i()+"Minutes"]()},v=function(){return e[i()+"Seconds"]()},j=function(){return e[i()+"Milliseconds"]()},M=function(){return n?0:e.getTimezoneOffset()},w=function(){return u(e)},D={d:function(){return y()},dd:function(){return d(y())},ddd:function(){return c.dayNames[h()]},DDD:function(){return l({y:p(),m:g(),d:y(),_:i(),dayName:c.dayNames[h()],short:!0})},dddd:function(){return c.dayNames[h()+7]},DDDD:function(){return l({y:p(),m:g(),d:y(),_:i(),dayName:c.dayNames[h()+7]})},m:function(){return g()+1},mm:function(){return d(g()+1)},mmm:function(){return c.monthNames[g()]},mmmm:function(){return c.monthNames[g()+12]},yy:function(){return String(p()).slice(2)},yyyy:function(){return d(p(),4)},h:function(){return x()%12||12},hh:function(){return d(x()%12||12)},H:function(){return x()},HH:function(){return d(x())},M:function(){return N()},MM:function(){return d(N())},s:function(){return v()},ss:function(){return d(v())},l:function(){return d(j(),3)},L:function(){return d(Math.floor(j()/10))},t:function(){return 12>x()?c.timeNames[0]:c.timeNames[1]},tt:function(){return 12>x()?c.timeNames[2]:c.timeNames[3]},T:function(){return 12>x()?c.timeNames[4]:c.timeNames[5]},TT:function(){return 12>x()?c.timeNames[6]:c.timeNames[7]},Z:function(){return a?"GMT":n?"UTC":f(e)},o:function(){return(M()>0?"-":"+")+d(100*Math.floor(Math.abs(M())/60)+Math.abs(M())%60,4)},p:function(){return(M()>0?"-":"+")+d(Math.floor(Math.abs(M())/60),2)+":"+d(Math.floor(Math.abs(M())%60),2)},S:function(){return["th","st","nd","rd"][y()%10>3?0:(y()%100-y()%10!=10)*y()%10]},W:function(){return w()},WW:function(){return d(w())},N:function(){return m(e)}};return t.replace(r,function(e){return e in D?D[e]():e.slice(1,e.length-1)})}var o={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",paddedShortDate:"mm/dd/yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},c={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(e).padStart(t,"0")},l=function(e){var t=e.y,n=e.m,r=e.d,a=e._,s=e.dayName,i=e.short,o=void 0!==i&&i,c=new Date,d=new Date;d.setDate(d[a+"Date"]()-1);var l=new Date;return(l.setDate(l[a+"Date"]()+1),c[a+"FullYear"]()===t&&c[a+"Month"]()===n&&c[a+"Date"]()===r)?o?"Tdy":"Today":d[a+"FullYear"]()===t&&d[a+"Month"]()===n&&d[a+"Date"]()===r?o?"Ysd":"Yesterday":l[a+"FullYear"]()===t&&l[a+"Month"]()===n&&l[a+"Date"]()===r?o?"Tmw":"Tomorrow":s},u=function(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());t.setDate(t.getDate()-(t.getDay()+6)%7+3);var n=new Date(t.getFullYear(),0,4);n.setDate(n.getDate()-(n.getDay()+6)%7+3);var r=t.getTimezoneOffset()-n.getTimezoneOffset();return t.setHours(t.getHours()-r),1+Math.floor((t-n)/(864e5*7))},m=function(e){var t=e.getDay();return 0===t&&(t=7),t},f=function(e){return(String(e).match(a)||[""]).pop().replace(s,"").replace(/GMT\+0000/g,"UTC")}}},function(e){e.O(0,[192,664,847,164,87,888,774,179],function(){return e(e.s=72038)}),_N_E=e.O()}]);