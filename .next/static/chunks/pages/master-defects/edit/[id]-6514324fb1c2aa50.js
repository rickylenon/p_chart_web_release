(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6120],{52845:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/master-defects/edit/[id]",function(){return a(63794)}])},45847:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});var r=a(85893),s=a(89630),l=a(5716);function i(e){let{children:t}=e;return(0,r.jsxs)("div",{className:"flex min-h-screen flex-col",children:[(0,r.jsx)(s.Z,{}),(0,r.jsx)("main",{className:"flex-1",children:(0,r.jsx)("div",{className:"container",children:t})}),(0,r.jsx)(l.Z,{})]})}},63794:function(e,t,a){"use strict";a.r(t);var r=a(85893),s=a(33299),l=a(11163),i=a(67294),o=a(45847),c=a(9008),n=a.n(c),d=a(98225);t.default=(0,d.c2)(function(){let{data:e,status:t}=(0,s.useSession)(),a=(0,l.useRouter)(),{id:c}=a.query,[d,u]=(0,i.useState)(!1),[h,m]=(0,i.useState)(!0),[x,f]=(0,i.useState)([]),[p,g]=(0,i.useState)([]),[b,y]=(0,i.useState)(null),[j,w]=(0,i.useState)(null),[v,N]=(0,i.useState)(""),[k,S]=(0,i.useState)(""),[C,F]=(0,i.useState)(""),[E,_]=(0,i.useState)(""),[A,q]=(0,i.useState)(""),[O,D]=(0,i.useState)(""),[T,P]=(0,i.useState)(!1),[Z,U]=(0,i.useState)(!0);(0,i.useEffect)(()=>{var r;console.log("Session status:",t),console.log("User role:",null==e?void 0:null===(r=e.user)||void 0===r?void 0:r.role),"unauthenticated"===t&&a.push("/auth/login")},[t,a,e]),(0,i.useEffect)(()=>{let e=async()=>{if(c)try{m(!0);let e=await fetch("/api/defects/".concat(c));if(!e.ok)throw Error("Failed to fetch defect");let t=await e.json();console.log("Fetched defect:",t),N(t.name||""),S(t.description||""),F(t.category||""),q(t.applicableOperation||""),D(t.machine||""),P(t.reworkable||!1),U(t.isActive)}catch(e){console.error("Error fetching defect:",e),y("Failed to load defect details")}finally{m(!1)}};"authenticated"===t&&c&&e()},[t,c]),(0,i.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/operation-steps");if(!e.ok)throw Error("Failed to fetch operations");let t=await e.json();console.log("Fetched operations:",t),f(t)}catch(e){console.error("Error fetching operations:",e),y("Failed to load operations")}},a=async()=>{try{let e=await fetch("/api/defects");if(!e.ok)throw Error("Failed to fetch defects");let t=await e.json();console.log("Fetched defects for categories:",t);let a=Array.from(new Set(t.map(e=>e.category).filter(Boolean)));g(a)}catch(e){console.error("Error fetching categories:",e)}};"authenticated"===t&&(e(),a())},[t]);let B=async e=>{if(e.preventDefault(),!v.trim()){y("Defect name is required");return}if(!A){y("Applicable operation is required");return}let t="new"===C&&E.trim()?E.trim():C;if(!t){y("Category is required");return}u(!0),y(null);try{let e=await fetch("/api/defects/".concat(c),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:v.trim(),description:k.trim()||null,category:t,applicableOperation:A,machine:O.trim()||null,reworkable:T,isActive:Z})});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to update defect")}let r=await e.json();console.log("Updated defect:",r),w("Defect updated successfully!"),setTimeout(()=>{a.push("/defects")},2e3)}catch(e){console.error("Error updating defect:",e),y(e.message||"Failed to update defect")}finally{u(!1)}};return"loading"===t||h?(0,r.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n(),{children:(0,r.jsx)("title",{children:"Edit Defect - P-Chart System"})}),(0,r.jsx)(o.Z,{children:(0,r.jsx)("div",{className:"py-6",children:(0,r.jsx)("div",{className:"max-w-3xl mx-auto space-y-6",children:(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Edit Defect"}),(0,r.jsx)("button",{onClick:()=>a.push("/defects"),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"Back to List"})]}),b&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded",children:b}),j&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-green-100 text-green-700 rounded",children:j}),(0,r.jsxs)("form",{onSubmit:B,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Name*"}),(0,r.jsx)("input",{type:"text",id:"name",value:v,onChange:e=>N(e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,r.jsx)("textarea",{id:"description",value:k,onChange:e=>S(e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm",rows:3})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 mb-1",children:"Category*"}),(0,r.jsxs)("select",{id:"category",value:C,onChange:e=>F(e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select Category"}),p.map(e=>(0,r.jsx)("option",{value:e,children:e},e)),(0,r.jsx)("option",{value:"new",children:"+ Add New Category"})]})]}),"new"===C&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"newCategory",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Category*"}),(0,r.jsx)("input",{type:"text",id:"newCategory",value:E,onChange:e=>_(e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"applicableOperation",className:"block text-sm font-medium text-gray-700 mb-1",children:"Applicable Operation*"}),(0,r.jsxs)("select",{id:"applicableOperation",value:A,onChange:e=>q(e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select Operation"}),x.map(e=>(0,r.jsxs)("option",{value:e.code,children:[e.code," - ",e.name]},e.code))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"machine",className:"block text-sm font-medium text-gray-700 mb-1",children:"Machine"}),(0,r.jsx)("input",{type:"text",id:"machine",value:O,onChange:e=>D(e.target.value),className:"w-full p-2 border border-gray-300 rounded shadow-sm"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",id:"reworkable",checked:T,onChange:e=>P(e.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded"}),(0,r.jsx)("label",{htmlFor:"reworkable",className:"ml-2 block text-sm text-gray-700",children:"Reworkable (can be fixed)"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",id:"isActive",checked:Z,onChange:e=>U(e.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded"}),(0,r.jsx)("label",{htmlFor:"isActive",className:"ml-2 block text-sm text-gray-700",children:"Active"})]}),(0,r.jsx)("div",{className:"pt-4",children:(0,r.jsx)("button",{type:"submit",className:"w-full md:w-auto px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors disabled:bg-blue-400",disabled:d,children:d?"Saving...":"Update Defect"})})]})]})})})})]})})}},function(e){e.O(0,[4192,1664,4430,7164,2888,9774,179],function(){return e(e.s=52845)}),_N_E=e.O()}]);