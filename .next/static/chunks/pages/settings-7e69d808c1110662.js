(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{13025:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(84297).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},23217:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(84297).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},73406:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings",function(){return t(74920)}])},2297:function(e,s,t){"use strict";t.d(s,{_:function(){return c}});var a=t(85893),r=t(67294),l=t(49102),n=t(12003),i=t(44531);let o=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.f,{ref:s,className:(0,i.cn)(o(),t),...r})});c.displayName=l.f.displayName},74920:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return b}});var a=t(85893),r=t(89630),l=t(5716),n=t(60129),i=e=>{let{children:s}=e;return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex flex-col",children:[(0,a.jsx)(r.Z,{}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 flex-grow",children:s}),(0,a.jsx)(l.Z,{}),(0,a.jsx)(n.x,{})]})},o=t(33299),c=t(11163),d=t(67294),x=t(87249),m=t(35037),p=t(2297);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let u=(0,t(84297).Z)("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);var h=t(23217),g=t(13025),f=t(28142),v=t(65050),j=t(98225),N=t(84105),y=t(48764).lW;function b(){var e,s,t;let{data:r,status:l}=(0,o.useSession)(),n=(0,c.useRouter)(),[b,w]=(0,d.useState)(!1),[E,M]=(0,d.useState)("update"),[P,k]=(0,d.useState)(null),[A,L]=(0,d.useState)(null),S=(0,d.useRef)(null),[U,C]=(0,d.useState)(!1);(0,d.useEffect)(()=>{"unauthenticated"===l&&n.push("/auth/login")},[l,n]);let O=async()=>{if(!P){(0,v.Am)({title:"No file selected",description:"Please select an Excel file to upload",variant:"destructive"});return}let e="replace"===E?"replace all existing":"update existing";if(confirm("Are you sure you want to ".concat(e," operation lines? ").concat("replace"===E?"This will delete all existing records and replace them with the Excel data.":"This will add new records from the Excel file, skipping any that already exist."))){w(!0),L(null);try{let e=await P.arrayBuffer(),s=y.from(e).toString("base64");console.log("Uploading operation lines..."),console.log("Mode:",E),console.log("File size:",P.size);let t=await (0,j.ri)("/api/admin/upload-operation-lines",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({excelData:s,mode:E})});console.log("Upload response status:",t.status);let a=await t.json();console.log("Upload response:",a),t.ok?((0,v.Am)({title:"Success",description:a.message,variant:"default"}),L(a.data),k(null),S.current&&(S.current.value="")):(console.error("Error uploading operation lines:",a.error),(0,v.Am)({title:"Error",description:a.error||"Failed to upload operation lines",variant:"destructive"}),a.details&&Array.isArray(a.details)&&L({errors:a.details}))}catch(e){console.error("Error calling upload API:",e),(0,v.Am)({title:"Error",description:"An unexpected error occurred",variant:"destructive"})}finally{w(!1)}}},_=async()=>{console.log("Exporting current operation lines data..."),C(!0);try{let e=await (0,j.ri)("/api/admin/export-operation-lines",{method:"GET"});console.log("Export response status:",e.status);let s=await e.json();if(console.log("Export response:",s),e.ok){let e=s.data.excelData,t=atob(e),a=new Uint8Array(t.length);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);let r=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=window.URL.createObjectURL(r),n=document.createElement("a");n.href=l,n.download=s.data.filename,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(l),(0,v.Am)({title:"Export successful",description:"Downloaded ".concat(s.data.totalRecords," operation lines (").concat(s.data.operationCount," operations, ").concat(s.data.lineCount," unique lines)"),variant:"default"}),console.log("Export completed: ".concat(s.data.totalRecords," records exported"))}else console.error("Error exporting operation lines:",s.error),(0,v.Am)({title:"Export failed",description:s.error||"Failed to export operation lines",variant:"destructive"})}catch(e){console.error("Error calling export API:",e),(0,v.Am)({title:"Export error",description:"An unexpected error occurred during export",variant:"destructive"})}finally{C(!1)}},F=(null==r?void 0:null===(e=r.user)||void 0===e?void 0:e.role)||"";console.log("User session:",r),console.log("User role:",F),console.log("Local storage user data:",j.UserSession.getSession());let T="string"==typeof F&&"admin"===F.toLowerCase();return"loading"===l?(0,a.jsx)("div",{children:"Loading..."}):(0,a.jsx)(i,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Settings"}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("p",{className:"text-gray-600",children:"Configure your preferences here."}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["Session status: ",l,", Role: ",F||"Not available",(0,a.jsx)("br",{}),"Local storage:"," ",j.UserSession.getSession()?"ID: ".concat(null===(s=j.UserSession.getSession())||void 0===s?void 0:s.id,", Role: ").concat(null===(t=j.UserSession.getSession())||void 0===t?void 0:t.role):"Not available"]})]})]}),T?(0,a.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:["Admin Tools",(0,a.jsx)(u,{className:"h-5 w-5 text-amber-500"})]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Operation Lines Management"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Upload an Excel file to update the operation lines database. Use standard Excel format where each column represents an operation (OP10, OP15, OP20, OP30, OP40) and each row contains the line numbers for that operation. Empty cells are ignored."}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"bg-blue-50 p-3 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-blue-900",children:"Export Current Data"}),(0,a.jsx)("p",{className:"text-xs text-blue-700",children:"Download the current operation lines data as Excel for editing"})]}),(0,a.jsx)(x.z,{onClick:_,disabled:U,variant:"outline",size:"sm",className:"flex items-center gap-1 text-blue-700 border-blue-300 hover:bg-blue-100",children:U?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.Z,{className:"h-3 w-3 animate-spin"}),"Exporting..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.Z,{className:"h-3 w-3"}),"Export Current"]})})]})}),(0,a.jsx)("div",{className:"bg-green-50 p-3 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-green-900",children:"Need the Excel format?"}),(0,a.jsx)("p",{className:"text-xs text-green-700",children:"Download a sample Excel file showing the proper format"})]}),(0,a.jsxs)(x.z,{onClick:()=>{let e=N.P6.book_new(),s=N.P6.aoa_to_sheet([["OP10","OP15","OP20","OP30","OP40"],["Machine #1","MX34 Harness","MX34 Harness","BUNDLE L1A","Terminal 1"],["Machine #2","MX39 Harness","MX39 Harness","BUNDLE L1B","Terminal 2"],["Machine #3","MX39B/45 Harness","MX39B/45 Harness","BUNDLE L2A","Terminal 3"],["Machine #4","MX39D Harness","MX39D Harness","BUNDLE L2B",""],["Machine #5","MX39F Harness","MX39F Harness","HITORI YATAI L1",""],["Machine #6","MX40 Harness","MX40 Harness","HITORI YATAI L2",""],["MY79 Cable Pre-Process","MX55J Cable Pre-Process FG L1","MX55J Cable Pre-Process FG L1","HITORI YATAI L3",""],["","MX55J Cable Pre-Process FG L2","MX55J Cable Pre-Process FG L2","HITORI YATAI L4",""]]);N.P6.book_append_sheet(e,s,"Operation Lines"),N.NC(e,"operation_lines_sample.xlsx"),(0,v.Am)({title:"Sample Excel downloaded",description:"Operations as columns, lines as rows - ready to customize",variant:"default"})},variant:"outline",size:"sm",className:"flex items-center gap-1 text-green-700 border-green-300 hover:bg-green-100",children:[(0,a.jsx)(g.Z,{className:"h-3 w-3"}),"Sample Excel"]})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(p._,{className:"text-sm font-medium",children:"Upload Mode"}),(0,a.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"radio",id:"update",name:"uploadMode",value:"update",checked:"update"===E,onChange:e=>M(e.target.value),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300","aria-label":"Update records mode"}),(0,a.jsxs)(p._,{htmlFor:"update",className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"Update records"})," - Insert new lines from Excel, skip existing ones"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"radio",id:"replace",name:"uploadMode",value:"replace",checked:"replace"===E,onChange:e=>M(e.target.value),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300","aria-label":"Replace all records mode"}),(0,a.jsxs)(p._,{htmlFor:"replace",className:"text-sm text-red-600",children:[(0,a.jsx)("span",{className:"font-medium",children:"Replace all records"})," ","- Delete all existing lines and insert new ones from Excel"]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(p._,{htmlFor:"excelFile",className:"text-sm font-medium",children:"Select Excel File"}),(0,a.jsx)(m.I,{ref:S,type:"file",id:"excelFile",accept:".xlsx,.xls,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel",onChange:e=>{var s;let t=null===(s=e.target.files)||void 0===s?void 0:s[0];if(t){if(!("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===t.type||"application/vnd.ms-excel"===t.type||t.name.endsWith(".xlsx")||t.name.endsWith(".xls"))){(0,v.Am)({title:"Invalid file type",description:"Please select an Excel file (.xlsx or .xls)",variant:"destructive"});return}k(t),L(null)}},className:"mt-1",disabled:b}),P&&(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Selected: ",P.name," (",(P.size/1024).toFixed(1)," KB)"]})]}),(0,a.jsx)(x.z,{onClick:O,disabled:b||!P,className:"flex items-center gap-2",children:b?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 animate-spin"}),"Uploading..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.Z,{className:"h-4 w-4"}),"Upload Operation Lines"]})})]}),A&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Upload Results:"}),(0,a.jsxs)("div",{className:"bg-gray-100 p-3 rounded text-sm",children:["replace"===A.mode?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"text-green-700",children:["✓ Deleted: ",A.deleted," existing records"]}),(0,a.jsxs)("div",{className:"text-green-700",children:["✓ Inserted: ",A.inserted," new records"]}),(0,a.jsxs)("div",{className:"text-gray-600",children:["Total processed: ",A.total]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"text-green-700",children:["✓ Inserted: ",A.inserted," new records"]}),(0,a.jsxs)("div",{className:"text-blue-600",children:["• Skipped: ",A.skipped," existing records"]}),(0,a.jsxs)("div",{className:"text-gray-600",children:["Total processed: ",A.total]})]}),A.errors&&A.errors.length>0&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("div",{className:"text-red-600 font-medium",children:"Errors:"}),(0,a.jsxs)("div",{className:"max-h-32 overflow-y-auto",children:[A.errors.slice(0,10).map((e,s)=>(0,a.jsxs)("div",{className:"text-red-600 text-xs",children:["• ",e]},s)),A.errors.length>10&&(0,a.jsx)("div",{className:"text-gray-500 text-xs italic",children:"(Showing first 10 errors. Check server logs for complete details)"})]})]})]})]})]})})]}):null]})})}},20067:function(){},72061:function(){},49102:function(e,s,t){"use strict";t.d(s,{f:function(){return i}});var a=t(67294),r=t(75320),l=t(85893),n=a.forwardRef((e,s)=>(0,l.jsx)(r.WV.label,{...e,ref:s,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(e.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));n.displayName="Label";var i=n}},function(e){e.O(0,[2251,4192,1664,4430,7164,2888,9774,179],function(){return e(e.s=73406)}),_N_E=e.O()}]);