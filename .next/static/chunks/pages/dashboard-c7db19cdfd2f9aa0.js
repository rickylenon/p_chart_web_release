(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8026],{26117:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return s(84812)}])},45847:function(e,t,s){"use strict";s.d(t,{Z:function(){return o}});var a=s(85893),l=s(89630),r=s(5716);function o(e){let{children:t}=e;return(0,a.jsxs)("div",{className:"flex min-h-screen flex-col",children:[(0,a.jsx)(l.Z,{}),(0,a.jsx)("main",{className:"flex-1",children:(0,a.jsx)("div",{className:"container",children:t})}),(0,a.jsx)(r.Z,{})]})}},33566:function(e,t,s){"use strict";var a=s(85893);s(67294);var l=s(87764),r=s(35037);t.Z=e=>{let{title:t,description:s,searchPlaceholder:o="Search...",searchValue:i="",onSearchChange:n,actions:d}=e;return console.log("PageHeader: Rendering for ".concat(t)),(0,a.jsx)("div",{className:"w-full",children:(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-purple-700",children:t}),s&&(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:s})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[n&&(0,a.jsxs)("div",{className:"relative w-96",children:[(0,a.jsx)(l.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-gray-500"}),(0,a.jsx)(r.I,{type:"search",placeholder:o,className:"pl-8",value:i,onChange:n})]}),d]})]})})}},49827:function(e,t,s){"use strict";s.d(t,{C:function(){return i}});var a=s(85893);s(67294);var l=s(12003),r=s(44531);let o=(0,l.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:s,...l}=e;return(0,a.jsx)("div",{className:(0,r.cn)(o({variant:s}),t),...l})}},2297:function(e,t,s){"use strict";s.d(t,{_:function(){return d}});var a=s(85893),l=s(67294),r=s(49102),o=s(12003),i=s(44531);let n=(0,o.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(r.f,{ref:t,className:(0,i.cn)(n(),s),...l})});d.displayName=r.f.displayName},17344:function(e,t,s){"use strict";s.d(t,{a:function(){return n}});var a=s(33299),l=s(11163),r=s(67294),o=s(98225),i=s(65050);function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{data:t,status:s}=(0,a.useSession)(),n=(0,l.useRouter)(),{toast:d}=(0,i.pm)(),[c,h]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!0),[x,g]=(0,r.useState)(null),[f,p]=(0,r.useState)(!1),{redirectTo:b="/auth/login",requiredRoles:j=[]}=e;(0,r.useEffect)(()=>{if(console.log("Auth effect running, status:",s,"verified:",f),"loading"===s||f)return;if(null==t?void 0:t.user){if(console.log("Found NextAuth session, storing to localStorage"),o.UserSession.storeSession(t.user),j.length>0){var e;let s=((null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.role)||"").toLowerCase();if(!j.some(e=>e.toLowerCase()===s)){console.log("Required role not found. User role: ".concat(s)),h(!1),m(!1),g("You do not have permission to access this page"),p(!0),n.push("/dashboard");return}}h(!0),m(!1),g(null),p(!0);return}let a=o.UserSession.getSession();if(a){if(console.log("Found valid localStorage session, using as fallback"),j.length>0){let e=(a.role||"").toLowerCase();if(!j.some(t=>t.toLowerCase()===e)){console.log("Required role not found. Local user role: ".concat(e)),h(!1),m(!1),g("You do not have permission to access this page"),p(!0),n.push("/dashboard");return}}h(!0),m(!1),g(null),p(!0);return}console.log("No valid session found, redirecting to login"),n.push("".concat(b,"?callbackUrl=").concat(encodeURIComponent(window.location.href)))},[s,t,n,b,j,f]);let v=(0,r.useCallback)(()=>o.UserSession.getAuthHeaders(),[]),y=(0,r.useCallback)(async()=>o.UserSession.getCurrentUser(),[]),N=(0,r.useCallback)(e=>o.UserSession.hasRole(e),[]),w=(0,r.useCallback)(()=>{console.log("Handling expired session"),o.UserSession.clearSession(),(0,a.signOut)({redirect:!1});let e=window.location.href;n.push("".concat(b,"?callbackUrl=").concat(encodeURIComponent(e),"&expired=true"))},[b,n]),k=(0,r.useCallback)(e=>{switch(e.status){case 401:return console.log("Detected 401 unauthorized response - session likely expired"),w(),!1;case 403:return console.log("Detected 403 forbidden response - permission denied"),d({title:"Permission Denied",description:"You don't have permission to access this resource",variant:"destructive"}),!1;case 429:return console.log("Detected 429 response - rate limited"),d({title:"Rate Limited",description:"Too many requests. Please try again later.",variant:"destructive"}),!1;case 500:case 502:case 503:case 504:return console.log("Detected server error (".concat(e.status,")")),d({title:"Server Error",description:"The server encountered an error. Please try again later.",variant:"destructive"}),!1}return!0},[w,d]);return{session:t,status:s,isAuthorized:c,isLoading:u,authError:x,getAuthHeaders:v,getCurrentUser:y,hasRole:N,handleExpiredSession:w,checkResponseAuth:k}}},84812:function(e,t,s){"use strict";s.r(t),s.d(t,{__N_SSP:function(){return z},default:function(){return B}});var a=s(85893),l=s(33299),r=s(11163),o=s(67294),i=s(45847),n=s(9008),d=s.n(n),c=s(2297),h=s(35037),u=s(49827),m=s(56989),x=s(17344);let g=(0,o.createContext)({filters:{year:new Date().getFullYear().toString(),month:"All",line:"All",series:"All",status:"All",poNumber:""},setFilters:()=>{},activeFilterCount:0}),f=()=>(0,o.useContext)(g);function p(){let{filters:e,setFilters:t}=f(),[s,l]=(0,o.useState)(null),[r,i]=(0,o.useState)(!0),[n,d]=(0,o.useState)({years:[],lines:[],series:[],statuses:[]}),{getAuthHeaders:g}=(0,x.a)(),p=(0,o.useCallback)(async(s,a)=>{try{i(!0),console.log("Fetching filter options with params:",{year:s,month:a});let l=new URLSearchParams;s&&l.append("year",s),a&&l.append("month",a);let r=await fetch("/api/dashboard/filter-options?".concat(l.toString()),{headers:g()});if(!r.ok)throw Error("Failed to fetch filter options");let o=await r.json();console.log("Loaded filter options:",o),d({years:o.years||[],lines:o.lines||[],series:o.series||[],statuses:o.statuses||[]}),!e.year&&o.years&&o.years.length>0&&t(e=>({...e,year:o.years[0].toString()}))}catch(e){console.error("Error fetching filter options:",e)}finally{i(!1)}},[e.year,t,i,d,g]);(0,o.useEffect)(()=>{p()},[p]),(0,o.useEffect)(()=>{e.year&&p(e.year,"All"!==e.month?e.month:void 0)},[e.year,e.month,p]),(0,o.useEffect)(()=>{"All"!==e.status?l("Status filter applies to production orders only"):"All"!==e.series?l("Series filter uses the first ".concat(5," digits of production order item name")):l(null)},[e.status,e.series]);let b="All"!==e.month||"All"!==e.line||"All"!==e.series||"All"!==e.status||""!==e.poNumber,j=["All"!==e.month?"Month":null,"All"!==e.line?"Line":null,"All"!==e.series?"Series":null,"All"!==e.status?"Status":null,e.poNumber?"PO Number":null].filter(Boolean).length;return(0,a.jsxs)("div",{className:"space-y-4 w-full dark:bg-black",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-2",children:[(0,a.jsxs)("h2",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center gap-2",children:["Filters",j>0&&(0,a.jsxs)(u.C,{variant:"secondary",className:"ml-2",children:[j," active"]})]}),b&&(0,a.jsx)("button",{onClick:()=>{t({year:e.year,month:"All",line:"All",series:"All",status:"All",poNumber:""}),console.log("Filters reset to defaults (keeping selected year)")},className:"text-sm text-blue-600 hover:text-blue-800 mt-2 sm:mt-2 sm:me-2",children:"Reset Filters"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)(c._,{htmlFor:"year-filter",className:"mb-2",children:"Year"}),(0,a.jsx)("select",{id:"year-filter",className:"h-10 w-full rounded-md border border-gray-300 bg-white dark:bg-black px-3 py-2 text-sm",value:e.year,onChange:s=>{let a=s.target.value;console.log("Year changed to:",a),t({...e,year:a,month:"All"})},disabled:r||0===n.years.length,"aria-label":"Filter by year",children:r?(0,a.jsx)("option",{children:"Loading..."}):n.years.length>0?n.years.map(e=>(0,a.jsx)("option",{value:e,children:e},e)):(0,a.jsx)("option",{value:"",children:"No data available"})})]}),(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)(c._,{htmlFor:"month-filter",className:"mb-2",children:"Month"}),(0,a.jsx)("select",{id:"month-filter",className:"h-10 w-full rounded-md border border-gray-300 bg-white dark:bg-black px-3 py-2 text-sm",value:e.month,onChange:s=>{t({...e,month:s.target.value})},disabled:r||!e.year,"aria-label":"Filter by month",children:[{value:"All",label:"All Months"},{value:"1",label:"January"},{value:"2",label:"February"},{value:"3",label:"March"},{value:"4",label:"April"},{value:"5",label:"May"},{value:"6",label:"June"},{value:"7",label:"July"},{value:"8",label:"August"},{value:"9",label:"September"},{value:"10",label:"October"},{value:"11",label:"November"},{value:"12",label:"December"}].map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)(c._,{htmlFor:"line-filter",className:"mb-2",children:"Production Line"}),(0,a.jsxs)("select",{id:"line-filter",className:"h-10 w-full rounded-md border border-gray-300 bg-white dark:bg-black px-3 py-2 text-sm",value:e.line,onChange:s=>{t({...e,line:s.target.value})},disabled:r||0===n.lines.length,"aria-label":"Filter by production line",children:[(0,a.jsx)("option",{value:"All",children:"All Lines"}),n.lines.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)(c._,{htmlFor:"series-filter",className:"flex items-center mb-2",children:["Series",(0,a.jsx)(m.Z,{className:"ml-1 text-blue-500 h-4 w-4","aria-label":"Series filter uses the first ".concat(5," digits of production order item name")})]}),(0,a.jsxs)("select",{id:"series-filter",className:"h-10 w-full rounded-md border border-gray-300 bg-white dark:bg-black px-3 py-2 text-sm",value:e.series,onChange:s=>{t({...e,series:s.target.value})},disabled:r||0===n.series.length,"aria-label":"Filter by product series",children:[(0,a.jsx)("option",{value:"All",children:"All Series"}),n.series.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)(c._,{htmlFor:"status-filter",className:"flex items-center mb-2",children:["Status","All"!==e.status&&(0,a.jsx)(m.Z,{className:"ml-1 text-blue-500 h-4 w-4","aria-label":"Status filter applies to production orders only"})]}),(0,a.jsxs)("select",{id:"status-filter",className:"h-10 w-full rounded-md border border-gray-300 bg-white dark:bg-black px-3 py-2 text-sm",value:e.status,onChange:s=>{t({...e,status:s.target.value})},disabled:r||0===n.statuses.length,"aria-label":"Filter by production order status",children:[(0,a.jsx)("option",{value:"All",children:"All Statuses"}),n.statuses.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)(c._,{htmlFor:"po-filter",className:"mb-2",children:"PO Number"}),(0,a.jsx)(h.I,{id:"po-filter",type:"text",className:"h-10",placeholder:"Enter PO number",value:e.poNumber,onChange:s=>{t({...e,poNumber:s.target.value})},"aria-label":"Filter by production order number"})]})]}),s&&(0,a.jsxs)("div",{className:"text-sm text-blue-600 flex items-center mt-2",children:[(0,a.jsx)(m.Z,{className:"mr-1 h-4 w-4"}),s]})]})}var b=s(47653);function j(e){let{title:t,value:s,description:l,valueColor:r="text-foreground dark:text-foreground",isLoading:o=!1,hasError:i=!1}=e;return(0,a.jsxs)("div",{className:"bg-card rounded-lg shadow p-6 border border-border",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-muted-foreground",children:t}),(0,a.jsx)("div",{className:"mt-2 flex items-baseline",children:o?(0,a.jsx)("p",{className:"text-3xl font-semibold text-muted-foreground/30 animate-pulse",children:"--"}):i?(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(b.Z,{className:"h-5 w-5 text-destructive mr-1"}),(0,a.jsx)("p",{className:"text-xl font-semibold text-destructive",children:"Error"})]}):(0,a.jsx)("p",{className:"text-3xl font-semibold ".concat(r),children:s})}),(0,a.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:l})]})}function v(e){var t,s,l,r,i;let{refreshTrigger:n=0}=e,{filters:d}=f(),{getAuthHeaders:c}=(0,x.a)(),[h,u]=(0,o.useState)({totalProduction:0,defectRate:0,inProgressPOs:0,machineUtilization:0,filteredStatusCount:null,appliedStatusValue:null}),[m,g]=(0,o.useState)(!0),[p,b]=(0,o.useState)(null),[v,y]=(0,o.useState)(null);return((0,o.useEffect)(()=>{let e=async()=>{try{g(!0),console.log("Fetching dashboard stats with filters:",d);let e=new URLSearchParams;d.year&&e.append("year",d.year),"All"!==d.month&&e.append("month",d.month),"All"!==d.line&&e.append("line",d.line),"All"!==d.series&&e.append("series",d.series),"All"!==d.status&&e.append("status",d.status),d.poNumber&&e.append("poNumber",d.poNumber);let t=e.toString(),s="/api/dashboard/stats".concat(t?"?".concat(t):"");console.log("Fetching from URL:",s);let a=await fetch(s,{headers:c()});if(!a.ok)throw Error("Failed to fetch dashboard stats");let l=await a.json();console.log("Dashboard stats data:",l),u(l),b(null),y(new Date)}catch(e){console.error("Error fetching dashboard stats:",e),b("Failed to load dashboard data")}finally{g(!1)}};e();let t=setInterval(e,6e4);return()=>clearInterval(t)},[d,n]),m)?(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(e=>(0,a.jsxs)("div",{className:"bg-card rounded-lg shadow p-6 border border-border animate-pulse",children:[(0,a.jsx)("div",{className:"h-2 bg-muted rounded mb-3 w-1/3"}),(0,a.jsx)("div",{className:"h-6 bg-muted rounded mb-2 w-1/2"}),(0,a.jsx)("div",{className:"h-2 bg-muted rounded w-2/3"})]},e))}):(p&&console.log("Error displaying stats:",p),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4",children:[(0,a.jsx)(j,{title:"Total Production",value:(i=h.totalProduction)<1e6?i.toLocaleString():i<1e9?"".concat((i/1e6).toFixed(1),"M"):i<1e12?"".concat((i/1e9).toFixed(1),"B"):"".concat((i/1e12).toFixed(1),"T"),description:"Sum of production order quantities",hasError:!!p}),(0,a.jsx)(j,{title:"Current Defect Rate",value:(t=h.defectRate,"".concat((100*t).toFixed(2),"%")),description:"Today's total defect / total input across completed operations",valueColor:(s=h.defectRate)<.01?"text-green-600 dark:text-green-400":s<.03?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400",hasError:!!p}),(0,a.jsx)(j,{title:h.appliedStatusValue?"".concat(h.appliedStatusValue," POs"):"In-Progress POs",value:h.appliedStatusValue?h.filteredStatusCount||0:h.inProgressPOs,description:h.appliedStatusValue?'Production Orders with status "'.concat(h.appliedStatusValue,'"'):'Production Orders with status "IN_PROGRESS"',hasError:!!p}),(0,a.jsx)(j,{title:"Machine Utilization",value:(l=h.machineUtilization,"".concat((100*l).toFixed(1),"%")),description:"Today's production hours / (machines \xd7 8 hours)",valueColor:(r=h.machineUtilization)>.8?"text-green-600 dark:text-green-400":r>.5?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400",hasError:!!p})]}),v&&!p&&(0,a.jsxs)("div",{className:"text-right text-xs text-muted-foreground",children:["Last updated: ",v.toLocaleTimeString()]})]}))}var y=s(29009),N=s(94831),w=s(14195),k=s(3023),S=s(75358),D=s(26050),A=s(33558),F=s(30483);let C=e=>{let{active:t,payload:s,label:l}=e;if(t&&s&&s.length){let e=s[0].value,t=s[1].value,r=e+t,o=r>0?t/r*100:0;return(0,a.jsxs)("div",{className:"bg-white p-4 border border-gray-200 shadow-md rounded-md",children:[(0,a.jsx)("p",{className:"font-bold",children:l}),(0,a.jsx)("p",{className:"text-emerald-600",children:"Good: ".concat(e.toLocaleString()," units (").concat((100-o).toFixed(2),"%)")}),(0,a.jsx)("p",{className:"text-red-600",children:"Defects: ".concat(t.toLocaleString()," units (").concat(o.toFixed(2),"%)")}),(0,a.jsx)("p",{className:"text-gray-500",children:"Total: ".concat(r.toLocaleString()," units")})]})}return null};function P(e){let{refreshTrigger:t=0}=e,{filters:s}=f(),{getAuthHeaders:l}=(0,x.a)(),[r,i]=(0,o.useState)([]),[n,d]=(0,o.useState)(!0),[c,h]=(0,o.useState)(null);return((0,o.useEffect)(()=>{(async()=>{try{d(!0),console.log("Fetching defect ratio data with filters:",s);let e=new URLSearchParams;s.year&&e.append("year",s.year),"All"!==s.month&&e.append("month",s.month),"All"!==s.line&&e.append("line",s.line),"All"!==s.series&&e.append("series",s.series),"All"!==s.status&&e.append("status",s.status),s.poNumber&&e.append("poNumber",s.poNumber),e.append("chart","defectRatio");let t=e.toString(),a="/api/dashboard/charts?".concat(t);console.log("Fetching from URL:",a),console.time("defectRatioChart");let r=await fetch(a,{headers:l()});if(!r.ok)throw Error("Failed to fetch defect ratio data");let o=await r.json();console.timeEnd("defectRatioChart"),console.log("Defect ratio data:",o.defectRatioData);let n=o.defectRatioData?o.defectRatioData.map(e=>({name:e.date,good:e.input-e.defects,defects:e.defects})):[];i(n),h(null)}catch(e){console.error("Error fetching defect ratio data:",e),h("Failed to load defect ratio data")}finally{d(!1)}})()},[s,t]),n)?(0,a.jsx)("div",{className:"bg-white rounded-lg shadow p-6 h-[450px] flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-pulse text-gray-400",children:"Loading chart data..."})}):c?(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 h-[450px] flex flex-col items-center justify-center",children:[(0,a.jsx)(b.Z,{className:"h-12 w-12 text-red-500 mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-red-500",children:"Failed to load chart"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:c})]}):0===r.length?(0,a.jsx)("div",{className:"bg-white rounded-lg shadow p-6 h-[450px] flex flex-col items-center justify-center",children:(0,a.jsxs)("div",{className:"text-gray-400 text-center",children:[(0,a.jsx)("p",{className:"mb-2 text-lg",children:"No data available for the selected filters"}),(0,a.jsx)("p",{className:"text-sm",children:"Try adjusting your filter criteria"})]})}):(0,a.jsxs)("div",{className:"bg-white dark:bg-black rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Production Output vs. Defects by Operation"}),(0,a.jsx)("div",{className:"h-[400px]",children:(0,a.jsx)(y.h,{width:"100%",height:"100%",children:(0,a.jsxs)(N.v,{data:r,margin:{top:20,right:30,left:20,bottom:30},children:[(0,a.jsx)(w.q,{strokeDasharray:"3 3"}),(0,a.jsx)(k.K,{dataKey:"name"}),(0,a.jsx)(S.B,{}),(0,a.jsx)(D.u,{content:(0,a.jsx)(C,{})}),(0,a.jsx)(A.D,{}),(0,a.jsx)(F.$,{dataKey:"good",stackId:"a",fill:"#10b981",name:"Good Output"}),(0,a.jsx)(F.$,{dataKey:"defects",stackId:"a",fill:"#ef4444",name:"Defects"})]})})})]})}let E=e=>{let{active:t,payload:s,label:l}=e;if(t&&s&&s.length){let e=s[0].payload;return(0,a.jsxs)("div",{className:"bg-white border border-gray-200 p-3 rounded-lg shadow-sm",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.fullName||"".concat(e.name," (").concat(e.category,")")}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"".concat(s[0].value," defects")})]})}return null},L=e=>{let{title:t}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:t}),(0,a.jsx)("div",{className:"flex items-center justify-center",style:{height:"300px"},children:(0,a.jsx)("p",{className:"text-gray-500",children:"No data available for selected filters"})})]})};function O(e){let{refreshTrigger:t=0}=e,{filters:s}=f(),{getAuthHeaders:l}=(0,x.a)(),[r,i]=(0,o.useState)([]),[n,d]=(0,o.useState)([]),[c,h]=(0,o.useState)(!0),[u,m]=(0,o.useState)(null);(0,o.useEffect)(()=>{let e=async()=>{try{var e;h(!0),console.log("Fetching machine defects chart data with filters:",s);let t=new URLSearchParams;s.year&&t.append("year",s.year),"All"!==s.month&&t.append("month",s.month),"All"!==s.line&&t.append("line",s.line),"All"!==s.series&&t.append("series",s.series),"All"!==s.status&&t.append("status",s.status),s.poNumber&&t.append("poNumber",s.poNumber),t.append("chart","all");let a=t.toString(),r="/api/dashboard/charts?".concat(a);console.log("Fetching from URL:",r),console.time("machineDefectsChart");let o=await fetch(r,{headers:l()});if(!o.ok)throw Error("Failed to fetch chart data");let n=await o.json();console.timeEnd("machineDefectsChart"),console.log("Machine defects chart data:",n.machineDefectsData),console.log("Defect types chart data:",n.defectTypesData);let c=(null===(e=n.machineDefectsData)||void 0===e?void 0:e.map(e=>({...e,total:e.total||e.defects})))||[];i(c||[]),d(n.defectTypesData||[]),m(null)}catch(e){console.error("Error fetching chart data:",e),m("Failed to load chart data")}finally{h(!1)}};e();let t=setInterval(e,3e5);return()=>clearInterval(t)},[s,t]);let g=2*Math.ceil(Math.max(...r.map(e=>e.defects),1)/2),p=Math.ceil(Math.max(...n.map(e=>e.value),1));return c?(0,a.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[1,2].map(e=>(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:1===e?"Top Defects per Machine":"Most Frequent Defects"}),(0,a.jsx)("div",{className:"mt-4 animate-pulse",style:{height:"300px"},children:(0,a.jsx)("div",{className:"h-full bg-gray-200 rounded"})})]},e))}):u?(console.log("Error displaying charts:",u),(0,a.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:["Top Defects per Machine","Most Frequent Defects"].map(e=>(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:e}),(0,a.jsx)("div",{className:"flex items-center justify-center",style:{height:"300px"},children:(0,a.jsx)("p",{className:"text-red-500",children:"Error loading chart data"})})]},e))})):(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[0===r.length?(0,a.jsx)(L,{title:"Top Defects per Machine"}):(0,a.jsxs)("div",{className:"bg-white dark:bg-black rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Top Defects per Machine"}),(0,a.jsx)("div",{className:"mt-4",style:{height:"300px"},children:(0,a.jsx)(y.h,{width:"100%",height:"100%",children:(0,a.jsxs)(N.v,{data:r,layout:"vertical",margin:{top:20,right:30,left:40,bottom:20},barSize:30,children:[(0,a.jsx)(w.q,{strokeDasharray:"3 3",stroke:"#e5e7eb",horizontal:!0}),(0,a.jsx)(k.K,{type:"number",domain:[0,g],ticks:Array.from({length:5},(e,t)=>t*g/4),axisLine:{stroke:"#e5e7eb"},tickLine:{stroke:"#e5e7eb"},tick:{fill:"#6b7280"}}),(0,a.jsx)(S.B,{dataKey:"name",type:"category",axisLine:{stroke:"#e5e7eb"},tickLine:{stroke:"#e5e7eb"},tick:{fill:"#6b7280"},width:60}),(0,a.jsx)(D.u,{content:(0,a.jsx)(E,{})}),(0,a.jsx)(F.$,{dataKey:"defects",fill:"#60a5fa",radius:[0,4,4,0]})]})})})]}),0===n.length?(0,a.jsx)(L,{title:"Most Frequent Defects"}):(0,a.jsxs)("div",{className:"bg-white dark:bg-black rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Most Frequent Defects"}),(0,a.jsx)("div",{className:"mt-4",style:{height:"300px"},children:(0,a.jsx)(y.h,{width:"100%",height:"100%",children:(0,a.jsxs)(N.v,{data:n,layout:"vertical",margin:{top:20,right:30,left:80,bottom:20},barSize:20,children:[(0,a.jsx)(w.q,{strokeDasharray:"3 3",stroke:"#e5e7eb",horizontal:!0}),(0,a.jsx)(k.K,{type:"number",domain:[0,p],ticks:Array.from({length:Math.min(p+1,6)},(e,t)=>Math.round(t*p/Math.min(p,5))),axisLine:{stroke:"#e5e7eb"},tickLine:{stroke:"#e5e7eb"},tick:{fill:"#6b7280"},allowDecimals:!1}),(0,a.jsx)(S.B,{dataKey:"name",type:"category",axisLine:{stroke:"#e5e7eb"},tickLine:{stroke:"#e5e7eb"},tick:{fill:"#6b7280"},width:80}),(0,a.jsx)(D.u,{content:(0,a.jsx)(E,{})}),(0,a.jsx)(F.$,{dataKey:"value",fill:"#4ade80",radius:[0,4,4,0]})]})})})]})]})}var R=s(98687),M=s(56880),T=s(66942);let U=e=>{let{active:t,payload:s,label:l}=e;if(t&&s&&s.length){let e=s[0].value;return(0,a.jsxs)("div",{className:"bg-white p-4 border border-gray-200 shadow-md rounded-md",children:[(0,a.jsx)("p",{className:"font-bold",children:l}),(0,a.jsx)("p",{className:"text-red-600",children:"Defect Cost: $".concat(e.toFixed(2))})]})}return null};function K(e){let{refreshTrigger:t=0}=e,{filters:s}=f(),{getAuthHeaders:l}=(0,x.a)(),[r,i]=(0,o.useState)([]),[n,d]=(0,o.useState)([]),[c,h]=(0,o.useState)(0),[u,m]=(0,o.useState)(!0),[g,p]=(0,o.useState)(null);return((0,o.useEffect)(()=>{(async()=>{try{m(!0),console.log("Fetching defect cost data with filters:",s);let e=new URLSearchParams;s.year&&e.append("year",s.year),"All"!==s.month&&e.append("month",s.month),"All"!==s.line&&e.append("line",s.line),"All"!==s.series&&e.append("series",s.series),"All"!==s.status&&e.append("status",s.status),s.poNumber&&e.append("poNumber",s.poNumber);let t=e.toString(),a="/api/dashboard/cost-charts?".concat(t);console.log("Fetching from URL:",a),console.time("defectCostChart");let r=await fetch(a,{headers:l()});if(!r.ok)throw Error("Failed to fetch defect cost data");let o=await r.json();console.timeEnd("defectCostChart"),console.log("Defect cost data:",o),i(o.operationCostData||[]),d(o.dailyCostData||[]),h(o.totalDefectCost||0),p(null)}catch(e){console.error("Error fetching defect cost data:",e),p("Failed to load defect cost data")}finally{m(!1)}})()},[s,t]),u)?(0,a.jsx)("div",{className:"bg-white dark:bg-black rounded-lg shadow p-6 h-[450px] flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-pulse text-gray-400",children:"Loading cost data..."})}):g?(0,a.jsxs)("div",{className:"bg-white dark:bg-black rounded-lg shadow p-6 h-[450px] flex flex-col items-center justify-center",children:[(0,a.jsx)(b.Z,{className:"h-12 w-12 text-red-500 mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-red-500",children:"Failed to load cost chart"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:g})]}):r.length>0||n.length>0?(0,a.jsxs)("div",{className:"space-y-6",children:[c>0&&(0,a.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(T.Z,{className:"h-8 w-8 text-red-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-red-900 dark:text-red-100",children:"Total Defect Cost"}),(0,a.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:"Based on current filters"})]})]}),(0,a.jsxs)("div",{className:"text-3xl font-bold text-red-600",children:["$",c.toFixed(2)]})]})}),r.length>0&&(0,a.jsxs)("div",{className:"bg-white dark:bg-black rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Defect Cost by Operation"}),(0,a.jsx)("div",{className:"h-[400px]",children:(0,a.jsx)(y.h,{width:"100%",height:"100%",children:(0,a.jsxs)(N.v,{data:r,margin:{top:20,right:30,left:20,bottom:30},children:[(0,a.jsx)(w.q,{strokeDasharray:"3 3"}),(0,a.jsx)(k.K,{dataKey:"name"}),(0,a.jsx)(S.B,{tickFormatter:e=>"$".concat(e)}),(0,a.jsx)(D.u,{content:(0,a.jsx)(U,{})}),(0,a.jsx)(A.D,{}),(0,a.jsx)(F.$,{dataKey:"cost",fill:"#ef4444",name:"Defect Cost ($)"})]})})})]}),n.length>0&&(0,a.jsxs)("div",{className:"bg-white dark:bg-black rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Daily Defect Cost Trend (Last 30 Days)"}),(0,a.jsx)("div",{className:"h-[400px]",children:(0,a.jsx)(y.h,{width:"100%",height:"100%",children:(0,a.jsxs)(R.w,{data:n,margin:{top:20,right:30,left:20,bottom:30},children:[(0,a.jsx)(w.q,{strokeDasharray:"3 3"}),(0,a.jsx)(k.K,{dataKey:"date",tickFormatter:e=>{let t=new Date(e);return"".concat(t.getMonth()+1,"/").concat(t.getDate())}}),(0,a.jsx)(S.B,{tickFormatter:e=>"$".concat(e)}),(0,a.jsx)(D.u,{content:(0,a.jsx)(U,{}),labelFormatter:e=>new Date(e).toLocaleDateString()}),(0,a.jsx)(A.D,{}),(0,a.jsx)(M.x,{type:"monotone",dataKey:"cost",stroke:"#ef4444",strokeWidth:2,dot:{fill:"#ef4444",strokeWidth:2,r:4},activeDot:{r:6},name:"Daily Defect Cost ($)"})]})})})]})]}):(0,a.jsxs)("div",{className:"bg-white dark:bg-black rounded-lg shadow p-6 h-[450px] flex flex-col items-center justify-center",children:[(0,a.jsx)(T.Z,{className:"h-12 w-12 text-gray-400 mb-4"}),(0,a.jsxs)("div",{className:"text-gray-400 text-center",children:[(0,a.jsx)("p",{className:"mb-2 text-lg",children:"No defect cost data available"}),(0,a.jsx)("p",{className:"text-sm",children:"Try adjusting your filter criteria or ensure operations have cost data"})]})]})}let _=e=>{let{active:t,payload:s,label:l}=e;if(t&&s&&s.length){var r,o,i;let e=(null===(r=s.find(e=>"started"===e.dataKey))||void 0===r?void 0:r.value)||0,t=(null===(o=s.find(e=>"completed"===e.dataKey))||void 0===o?void 0:o.value)||0,n=(null===(i=s.find(e=>"total"===e.dataKey))||void 0===i?void 0:i.value)||0;return(0,a.jsxs)("div",{className:"bg-white p-4 border border-gray-200 shadow-md rounded-md",children:[(0,a.jsx)("p",{className:"font-bold",children:l}),(0,a.jsx)("p",{className:"text-blue-600",children:"Started: ".concat(e," P.O.s")}),(0,a.jsx)("p",{className:"text-green-600",children:"Completed: ".concat(t," P.O.s")}),(0,a.jsx)("p",{className:"text-gray-600",children:"Total Active: ".concat(n," P.O.s")})]})}return null};function Z(e){let{refreshTrigger:t=0}=e;console.log("\uD83D\uDFE2 POProgressChart: Component is rendering!",{refreshTrigger:t});let{filters:s}=f(),{getAuthHeaders:l}=(0,x.a)(),[r,i]=(0,o.useState)([]),[n,d]=(0,o.useState)(!0),[c,h]=(0,o.useState)(null);return(console.log("\uD83D\uDFE1 POProgressChart: Current filters:",s),console.log("\uD83D\uDFE1 POProgressChart: getAuthHeaders function:",typeof l),(0,o.useEffect)(()=>{console.log("\uD83D\uDD35 POProgressChart: useEffect triggered!",{filters:s,refreshTrigger:t}),(async()=>{try{var e;d(!0),h(null),console.log("\uD83D\uDE80 POProgressChart: Starting fetch with filters:",s);let t=new URLSearchParams;s.year&&t.append("year",s.year),"All"!==s.month&&t.append("month",s.month),"All"!==s.line&&t.append("line",s.line),"All"!==s.series&&t.append("series",s.series),"All"!==s.status&&t.append("status",s.status),s.poNumber&&t.append("poNumber",s.poNumber);let a=t.toString(),r="/api/dashboard/po-progress?".concat(a);console.log("Fetching P.O. progress from URL:",r),console.time("poProgressChart");let o=await fetch(r,{headers:l()});if(!o.ok){let e=await o.text();throw console.error("P.O. progress API error:",o.status,e),Error("Failed to fetch P.O. progress data: ".concat(o.status))}let n=await o.json();console.timeEnd("poProgressChart"),console.log("P.O. progress data received:",{dataLength:(null===(e=n.progressData)||void 0===e?void 0:e.length)||0,dateRange:n.dateRange,appliedFilters:n.appliedFilters}),i(n.progressData||[]),h(null)}catch(e){console.error("Error fetching P.O. progress data:",e),h("Failed to load P.O. progress data")}finally{d(!1)}})()},[s,t]),n)?(0,a.jsx)("div",{className:"bg-white dark:bg-black rounded-lg shadow p-6 h-[450px] flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-pulse text-gray-400",children:"Loading P.O. progress data..."})}):c?(0,a.jsxs)("div",{className:"bg-white dark:bg-black rounded-lg shadow p-6 h-[450px] flex flex-col items-center justify-center",children:[(0,a.jsx)(b.Z,{className:"h-12 w-12 text-red-500 mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-red-500",children:"Failed to load chart"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:c})]}):0===r.length?(0,a.jsx)("div",{className:"bg-white dark:bg-black rounded-lg shadow p-6 h-[450px] flex flex-col items-center justify-center",children:(0,a.jsxs)("div",{className:"text-gray-400 text-center",children:[(0,a.jsx)("p",{className:"mb-2 text-lg",children:"No P.O. progress data available for the selected filters"}),(0,a.jsx)("p",{className:"text-sm",children:"Try adjusting your filter criteria"})]})}):(0,a.jsxs)("div",{className:"bg-white dark:bg-black rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Production Order Progress - Monthly View"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Daily view of P.O.s started (OP10 start) and completed (OP40 completion) throughout the month"}),(0,a.jsx)("div",{className:"h-[400px]",children:(0,a.jsx)(y.h,{width:"100%",height:"100%",children:(0,a.jsxs)(N.v,{data:r,margin:{top:20,right:30,left:20,bottom:30},children:[(0,a.jsx)(w.q,{strokeDasharray:"3 3"}),(0,a.jsx)(k.K,{dataKey:"day",angle:-45,textAnchor:"end",height:60,interval:0}),(0,a.jsx)(S.B,{}),(0,a.jsx)(D.u,{content:(0,a.jsx)(_,{})}),(0,a.jsx)(A.D,{}),(0,a.jsx)(F.$,{dataKey:"started",fill:"#3b82f6",name:"P.O.s Started"}),(0,a.jsx)(F.$,{dataKey:"completed",fill:"#10b981",name:"P.O.s Completed"})]})})})]})}var q=s(42297),I=s(33566),$=s(87249);console.log("\uD83D\uDCE6 Dashboard: POProgressChart imported:","function");var z=!0;function B(){let{data:e}=(0,l.useSession)();(0,r.useRouter)();let[t,s]=(0,o.useState)({year:new Date().getFullYear().toString(),month:"All",line:"All",series:"All",status:"All",poNumber:""}),[n,c]=(0,o.useState)(0),h=(0,o.useMemo)(()=>{let e=0;return"All"!==t.month&&e++,"All"!==t.line&&e++,"All"!==t.series&&e++,"All"!==t.status&&e++,t.poNumber&&e++,e},[t]),u=(0,o.useCallback)(()=>{console.log("Manually refreshing dashboard data..."),c(e=>e+1)},[]);return(0,o.useEffect)(()=>{console.log("Dashboard filters updated:",t),console.log("Active filter count:",h)},[t,h]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d(),{children:(0,a.jsx)("title",{children:"Dashboard - P-Chart System"})}),(0,a.jsx)(g.Provider,{value:{filters:t,setFilters:s,activeFilterCount:h},children:(0,a.jsx)(i.Z,{children:(0,a.jsxs)("div",{className:"py-6 space-y-6",children:[(0,a.jsx)(I.Z,{title:"Dashboard",description:"Overview of production metrics and defect analysis",actions:(0,a.jsx)($.z,{onClick:u,variant:"outline",size:"icon",className:"p-2 rounded-full bg-purple-50 text-purple-600 hover:bg-purple-100","aria-label":"Refresh dashboard data",title:"Refresh dashboard data",children:(0,a.jsx)(q.Z,{size:20})})}),(0,a.jsx)("div",{className:"bg-white dark:bg-black shadow rounded-lg p-6",children:(0,a.jsx)(p,{})}),(0,a.jsx)(v,{refreshTrigger:n}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(Z,{refreshTrigger:n}),(0,a.jsx)(P,{refreshTrigger:n}),(0,a.jsx)(O,{refreshTrigger:n}),(0,a.jsx)(K,{refreshTrigger:n})]})]})})})]})}}},function(e){e.O(0,[4192,1664,4430,6958,7164,2888,9774,179],function(){return e(e.s=26117)}),_N_E=e.O()}]);