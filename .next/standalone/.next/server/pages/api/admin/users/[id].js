"use strict";(()=>{var e={};e.id=2846,e.ids=[2846],e.modules={53524:e=>{e.exports=require("@prisma/client")},98432:e=>{e.exports=require("bcryptjs")},60614:e=>{e.exports=require("next-auth/jwt")},62113:e=>{e.exports=require("next-auth/next")},47449:e=>{e.exports=require("next-auth/providers/credentials")},41649:e=>{e.exports=require("next-auth/react")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},25184:(e,r,t)=>{t.r(r),t.d(r,{config:()=>f,default:()=>p,routeModule:()=>h});var s={};t.r(s),t.d(s,{default:()=>m});var a=t(71802),n=t(47153),o=t(56249),i=t(66826),u=t(44507),d=t(98432),l=t.n(d);async function c(e,r,t){console.log("Admin User API called for specific user");let s=t?.user?.role||"",a="string"==typeof s&&"admin"===s.toLowerCase();if(console.log("User role:",s,"Is admin?",a),!a)return console.log("Non-admin user tried to access user management"),r.status(403).json({error:"Only admin users can manage users"});let{id:n}=e.query,o=parseInt(n,10);if(isNaN(o))return r.status(400).json({error:"Invalid user ID"});if(console.log(`Processing request for user ID: ${o}`),"GET"===e.method)try{let e=await u.Z.user.findUnique({where:{id:o},select:{id:!0,username:!0,name:!0,email:!0,role:!0,isActive:!0,createdAt:!0,lastLogin:!0,department:!0}});if(!e)return r.status(404).json({error:"User not found"});return console.log(`Fetched user: ${e.username}`),r.status(200).json(e)}catch(e){return console.error("Error fetching user:",e),r.status(500).json({error:"Failed to fetch user"})}if("PUT"===e.method)try{let{username:t,password:s,name:a,email:n,role:i,department:d,isActive:c}=e.body,m=await u.Z.user.findUnique({where:{id:o}});if(!m)return r.status(404).json({error:"User not found"});let p={name:a||null,email:n||null,role:i,department:d||null,isActive:c??m.isActive};s&&(p.password=await l().hash(s,10));let f=await u.Z.user.update({where:{id:o},data:p,select:{id:!0,username:!0,name:!0,email:!0,role:!0,isActive:!0,createdAt:!0,lastLogin:!0,department:!0}});return console.log(`Updated user: ${f.username}`),r.status(200).json(f)}catch(e){return console.error("Error updating user:",e),r.status(500).json({error:"Failed to update user"})}if("DELETE"===e.method)try{if(!await u.Z.user.findUnique({where:{id:o}}))return r.status(404).json({error:"User not found"});let e=await u.Z.user.update({where:{id:o},data:{isActive:!1},select:{id:!0,username:!0,name:!0,email:!0,role:!0,isActive:!0,createdAt:!0,lastLogin:!0,department:!0}});return console.log(`Deactivated user: ${e.username}`),r.status(200).json(e)}catch(e){return console.error("Error deactivating user:",e),r.status(500).json({error:"Failed to deactivate user"})}return r.status(405).json({error:"Method not allowed"})}let m=(0,i.QO)(c),p=(0,o.l)(s,"default"),f=(0,o.l)(s,"config"),h=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/admin/users/[id]",pathname:"/api/admin/users/[id]",bundlePath:"",filename:""},userland:s})}};var r=require("../../../../webpack-api-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[549],()=>t(25184));module.exports=s})();